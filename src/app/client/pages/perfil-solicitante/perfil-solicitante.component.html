<div class="perfil-container">
  <div class="perfil-wrapper">
    <header class="perfil-header">
      <h1 class="perfil-title">Perfil del Cliente</h1>
      <p class="perfil-subtitle">
        Información visible solo para ti como proveedor. Úsala para preparar el servicio y registrar futuras evaluaciones.
      </p>
    </header>

    <div class="perfil-card">
      <ng-container *ngIf="loading">
        <div class="perfil-loading">
          <div class="perfil-loading__spinner"></div>
          <p>Cargando información del cliente...</p>
        </div>
      </ng-container>

      <ng-container *ngIf="!loading && error">
        <div class="perfil-error">
          <h2 class="perfil-error__title">No se pudo cargar el perfil</h2>
          <p class="perfil-error__message">{{ error }}</p>
        </div>
      </ng-container>

      <ng-container *ngIf="!loading && !error && profile">
        <div class="perfil-hero">
          <div class="perfil-avatar-container">
            <div class="perfil-avatar">
              <ng-container *ngIf="profilePhotoUrl; else avatarFallback">
                <img [src]="profilePhotoUrl" [alt]="clientName" class="perfil-avatar-img" loading="lazy">
              </ng-container>
              <ng-template #avatarFallback>
                <span class="perfil-avatar-placeholder">{{ getInitials(clientName) }}</span>
              </ng-template>
            </div>
          </div>
          <div class="perfil-info">
            <h2 class="perfil-name">{{ clientName }}</h2>
            <p class="perfil-member-since">{{ memberSinceLabel }}</p>
            <div class="perfil-verification-badge" [attr.data-state]="verificationStatusVariant">
              <span>{{ verificationStatusLabel }}</span>
            </div>
          </div>
        </div>

        <hr class="perfil-divider">

        <section class="perfil-section">
          <h3 class="perfil-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            Datos personales y contacto
          </h3>
          <div class="perfil-form-grid perfil-form-grid--readonly">
            <div class="perfil-field">
              <label class="perfil-label">Nombre completo</label>
              <div class="perfil-field-value">{{ profile.full_name || 'Dato no registrado' }}</div>
            </div>
            <div class="perfil-field">
              <label class="perfil-label">Email (privado)</label>
              <div class="perfil-field-value">{{ profile.email || 'Dato no registrado' }}</div>
            </div>
            <div class="perfil-field">
              <label class="perfil-label">Teléfono de contacto</label>
              <div class="perfil-field-value">{{ profile.phone || 'Dato no registrado' }}</div>
              <p class="perfil-field-help perfil-field-help--readonly">
                Visible solo para profesionales con citas confirmadas.
              </p>
            </div>
          </div>
        </section>

        <section class="perfil-section">
          <h3 class="perfil-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Ubicación principal
          </h3>
          <div class="perfil-form-grid perfil-form-grid--readonly">
            <div class="perfil-field">
              <label class="perfil-label">Región</label>
              <div class="perfil-field-value">{{ profile.region || 'Dato no registrado' }}</div>
            </div>
            <div class="perfil-field">
              <label class="perfil-label">Comuna</label>
              <div class="perfil-field-value">{{ profile.commune || 'Dato no registrado' }}</div>
            </div>
            <div class="perfil-field perfil-field--full">
              <label class="perfil-label">Dirección principal</label>
              <div class="perfil-field-value">{{ profile.address || 'Dato no registrado' }}</div>
              <p class="perfil-field-help perfil-field-help--readonly">
                Usa esta referencia para planificar la visita. Confirma con el cliente si necesitas más detalles.
              </p>
            </div>
          </div>
        </section>

        <section class="perfil-section" *ngIf="showNotes">
          <h3 class="perfil-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            Notas permanentes
          </h3>
          <div class="perfil-notes">{{ profile.notes }}</div>
        </section>

        <section class="perfil-section perfil-futuro">
          <h3 class="perfil-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c0 1.105.895 2 2 2s2-.895 2-2-.895-2-2-2-2 .895-2 2zm-9 9c0-4.418 3.582-8 8-8h2c4.418 0 8 3.582 8 8v1H3v-1z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 6a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Evaluaciones futuras
          </h3>
          <p class="perfil-section-description">
            Próximamente podrás calificar al cliente y dejar comentarios sobre la experiencia del servicio.
          </p>
        </section>
      </ng-container>
    </div>
  </div>
</div>

