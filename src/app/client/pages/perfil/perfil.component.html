<div class="perfil-container">
  <div class="perfil-wrapper">
    
    <!-- ENCABEZADO Y RESUMEN -->
    <header class="perfil-header">
      <h1 class="perfil-title">
        Mi Perfil de Solicitante
      </h1>
      <p class="perfil-subtitle">
        Mantén tu información al día para una mejor experiencia al contratar servicios.
      </p>
    </header>

    <!-- TARJETA PRINCIPAL DEL PERFIL -->
    <div class="perfil-card">
      
      <!-- SECCIÓN DE FOTO Y REPUTACIÓN -->
      <div class="perfil-hero">
        <div class="perfil-avatar-container">
          <!-- Input file oculto -->
          <input 
            type="file" 
            id="photoInput" 
            accept="image/jpeg,image/jpg,image/png,image/webp"
            (change)="onPhotoChange($event)"
            style="display: none;">

          <!-- Avatar con foto o icono por defecto -->
          <div class="perfil-avatar" [class.perfil-avatar--loading]="isUploadingPhoto">
            <!-- Mostrar spinner mientras sube -->
            <div *ngIf="isUploadingPhoto" class="perfil-avatar-spinner">
              <svg class="perfil-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </div>

            <!-- Preview de nueva foto o foto actual o icono por defecto -->
            <img 
              *ngIf="!isUploadingPhoto && (photoPreview || fullPhotoUrl)" 
              [src]="photoPreview || fullPhotoUrl" 
              alt="Foto de perfil"
              class="perfil-avatar-img">
            
            <svg 
              *ngIf="!isUploadingPhoto && !photoPreview && !profilePhotoUrl"
              xmlns="http://www.w3.org/2000/svg" 
              class="perfil-avatar-icon" 
              viewBox="0 0 24 24" 
              fill="none" 
              stroke="currentColor" 
              stroke-width="1.5" 
              stroke-linecap="round" 
              stroke-linejoin="round">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>

          <!-- Botón para cambiar foto -->
          <button 
            type="button"
            class="perfil-avatar-edit" 
            (click)="triggerPhotoUpload()"
            [disabled]="isUploadingPhoto"
            title="Cambiar foto de perfil">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-avatar-edit-icon" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
        
        <div class="perfil-info">
          <h2 class="perfil-name">{{ fullName }}</h2>
          <p class="perfil-member-since">{{ memberSinceLabel }}</p>
          <div class="perfil-verification-badge" [attr.data-state]="verificationStatusVariant">
            <span *ngIf="verificationLoading" class="perfil-verification-badge__spinner"></span>
            <span *ngIf="!verificationLoading">{{ verificationStatusLabel }}</span>
          </div>
        </div>
      </div>

      <!-- DIVISOR SUTIL -->
      <hr class="perfil-divider">

      <!-- FORMULARIO DE INFORMACIÓN -->
      <form class="perfil-form" (ngSubmit)="saveProfile()">
        
        <!-- DATOS PERSONALES Y CONTACTO -->
        <div class="perfil-section">
          <h3 class="perfil-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            Datos Personales y Contacto
          </h3>
          <div class="perfil-form-grid">
            <div class="perfil-field">
              <label for="fullName" class="perfil-label">
                Nombre Completo <span class="perfil-required">*</span>
              </label>
              <div class="perfil-input-wrapper">
                <input 
                  type="text" 
                  id="fullName" 
                  [(ngModel)]="fullName" 
                  name="fullName"
                  required 
                  class="perfil-input">
                <svg class="perfil-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
              </div>
            </div>

            <div class="perfil-field">
              <label for="email" class="perfil-label">Email (Privado)</label>
              <div class="perfil-input-wrapper">
                <input 
                  type="email" 
                  id="email" 
                  [(ngModel)]="email" 
                  name="email"
                  class="perfil-input" 
                  disabled>
              </div>
            </div>

            <div class="perfil-field">
              <label for="phone" class="perfil-label">
                Teléfono de Contacto <span class="perfil-required">*</span>
              </label>
              <div class="perfil-input-wrapper">
                <input 
                  type="tel" 
                  id="phone" 
                  [(ngModel)]="phone" 
                  name="phone"
                  required 
                  class="perfil-input">
                <svg class="perfil-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
              </div>
              <p class="perfil-field-help">Visible para el profesional una vez acepte el servicio.</p>
            </div>
            
            <div class="perfil-field">
              <label for="dob" class="perfil-label">Fecha de Nacimiento</label>
              <div class="perfil-input-wrapper">
                <input 
                  type="date" 
                  id="dob" 
                  [(ngModel)]="dob" 
                  name="dob"
                  class="perfil-input">
                <svg class="perfil-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- UBICACIÓN PRINCIPAL -->
        <div class="perfil-section">
          <h3 class="perfil-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Ubicación Principal
          </h3>
          
          <div class="perfil-form-grid">
            <div class="perfil-field">
              <label for="region" class="perfil-label">
                Región <span class="perfil-required">*</span>
              </label>
              <div class="perfil-input-wrapper">
                <select 
                  id="region" 
                  [(ngModel)]="region" 
                  name="region"
                  required 
                  class="perfil-input">
                  <option value="">Selecciona una región</option>
                  <option value="Arica y Parinacota">Arica y Parinacota</option>
                  <option value="Tarapacá">Tarapacá</option>
                  <option value="Antofagasta">Antofagasta</option>
                  <option value="Atacama">Atacama</option>
                  <option value="Coquimbo">Coquimbo</option>
                  <option value="Valparaíso">Valparaíso</option>
                  <option value="Metropolitana">Región Metropolitana</option>
                  <option value="O'Higgins">Libertador Gral. Bernardo O'Higgins</option>
                  <option value="Maule">Maule</option>
                  <option value="Ñuble">Ñuble</option>
                  <option value="Biobío">Biobío</option>
                  <option value="La Araucanía">La Araucanía</option>
                  <option value="Los Ríos">Los Ríos</option>
                  <option value="Los Lagos">Los Lagos</option>
                  <option value="Aysén">Aysén</option>
                  <option value="Magallanes">Magallanes y Antártica Chilena</option>
                </select>
              </div>
            </div>

            <div class="perfil-field">
              <label for="commune" class="perfil-label">
                Comuna <span class="perfil-required">*</span>
              </label>
              <div class="perfil-input-wrapper">
                <input 
                  type="text" 
                  id="commune" 
                  [(ngModel)]="commune" 
                  name="commune"
                  required 
                  placeholder="Ej: Santiago, Providencia, Las Condes..."
                  class="perfil-input">
                <svg class="perfil-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
              </div>
            </div>

            <div class="perfil-field" style="grid-column: 1 / -1;">
              <label for="address" class="perfil-label">
                Dirección Principal <span class="perfil-required">*</span>
              </label>
              <div class="perfil-input-wrapper">
                <input 
                  type="text" 
                  id="address" 
                  [(ngModel)]="address" 
                  name="address"
                  required 
                  placeholder="Ej: Av. Libertador 1234, Depto 501"
                  class="perfil-input">
                <svg class="perfil-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
              </div>
              <p class="perfil-field-help">Usada como referencia inicial para todos tus servicios a domicilio.</p>
            </div>
          </div>
        </div>

        <!-- INSTRUCCIONES Y PREFERENCIAS -->
        <div class="perfil-section">
          <h3 class="perfil-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            Instrucciones y Preferencias
          </h3>
          <div class="perfil-field">
            <label for="notes" class="perfil-label">Notas Permanentes para el Profesional</label>
            <div class="perfil-input-wrapper">
              <textarea 
                id="notes" 
                [(ngModel)]="notes" 
                name="notes"
                rows="4" 
                class="perfil-input perfil-textarea" 
                placeholder="Ej: 'El timbre no funciona, golpear la puerta.' o 'Tengo un gato en casa.'"></textarea>
              <svg class="perfil-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
              </svg>
            </div>
            <p class="perfil-field-help">Estas notas se adjuntarán a todas tus solicitudes de servicio.</p>
          </div>
        </div>
      </form>
      
      <!-- DIVISOR SUTIL -->
      <hr class="perfil-divider">

      <!-- VERIFICACIÓN DE IDENTIDAD -->
      <section class="perfil-section perfil-verificacion">
        <h3 class="perfil-section-title">
          <svg xmlns="http://www.w3.org/2000/svg" class="perfil-section-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c0 1.105.895 2 2 2s2-.895 2-2-.895-2-2-2-2 .895-2 2zm-9 9c0-4.418 3.582-8 8-8h2c4.418 0 8 3.582 8 8v1H3v-1z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 6a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          Verificación de identidad
        </h3>
        <p class="perfil-section-description">
          Aporta una capa extra de confianza verificando tu identidad. Tus datos están protegidos y solo se usan para validar tu cuenta.
        </p>
        <app-client-verificacion-perfil (statusChange)="onVerificationStatusChange($event)"></app-client-verificacion-perfil>
      </section>

      <!-- BOTÓN DE GUARDADO Y FEEDBACK -->
      <div class="perfil-actions">
        <div class="perfil-actions-info">
          <p class="perfil-actions-text">
            Guarda tus cambios para mantener tu perfil actualizado.
          </p>
        </div>
        <div class="perfil-actions-buttons">
          <button 
            type="button" 
            (click)="saveProfile()" 
            [disabled]="isSaving"
            class="perfil-save-button">
            <svg *ngIf="!isSaving" class="perfil-save-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <svg *ngIf="isSaving" class="perfil-save-icon perfil-save-icon--spinning" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="perfil-spinner-circle" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="perfil-spinner-path" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            {{ isSaving ? 'Guardando...' : 'Guardar Cambios' }}
          </button>
          <div class="perfil-feedback" [class.perfil-feedback--success]="feedbackType === 'success'" [class.perfil-feedback--error]="feedbackType === 'error'">
            {{ feedbackMessage }}
          </div>
        </div>
      </div>

    </div>
  </div>
</div>



