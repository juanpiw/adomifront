<div class="client-layout" [class.sidebar-collapsed]="isCollapsed">
  <aside class="sidebar" [class.collapsed]="isCollapsed">
    <!-- Rail Menu (siempre visible) -->
    <div class="rail">
      <button class="rail-toggle" (click)="isCollapsed = !isCollapsed" title="Contraer/Expandir">
        <ui-icon [name]="isCollapsed ? 'chevron-right' : 'chevron-left'" [size]="16"></ui-icon>
      </button>
      <a class="rail-item" routerLink="/client/explorar" routerLinkActive="active" title="Explorar" (click)="onNav()">
        <ui-icon name="search" [size]="18"></ui-icon>
      </a>
      <a class="rail-item" routerLink="/client/reservas" routerLinkActive="active" title="Mis Reservas" (click)="onNav()" style="position:relative;">
        <ui-icon name="calendar" [size]="18"></ui-icon>
        <span *ngIf="appointmentBadge > 0" class="badge-unread">{{ appointmentBadge }}</span>
      </a>
              <a class="rail-item" routerLink="/client/favoritos" routerLinkActive="active" title="Favoritos" (click)="onNav()">
                <ui-icon name="heart" [size]="18"></ui-icon>
              </a>
              <a class="rail-item" routerLink="/client/conversaciones" routerLinkActive="active" title="Conversaciones" (click)="onNav()" style="position:relative;">
                <ui-icon name="message" [size]="18"></ui-icon>
                <span *ngIf="unreadTotal > 0" class="badge-unread">{{ unreadTotal }}</span>
              </a>
              <a class="rail-item" routerLink="/client/perfil" routerLinkActive="active" title="Mi Perfil" (click)="onNav()">
                <ui-icon name="user" [size]="18"></ui-icon>
              </a>
      <a class="rail-item" routerLink="/client/wallet" routerLinkActive="active" title="Mi Billetera" (click)="onNav()">
        <ui-icon name="wallet" [size]="18"></ui-icon>
      </a>
      <a class="rail-item" routerLink="/client/pagos" routerLinkActive="active" title="Métodos de Pago" (click)="onNav()">
        <ui-icon name="card" [size]="18"></ui-icon>
      </a>
      <a class="rail-item" routerLink="/client/soporte" routerLinkActive="active" title="Soporte" (click)="onNav()">
        <ui-icon name="help-circle" [size]="18"></ui-icon>
      </a>
      <a class="rail-item" routerLink="/client/configuracion" routerLinkActive="active" title="Configuración" (click)="onNav()">
        <ui-icon name="settings" [size]="18"></ui-icon>
      </a>
      <div class="spacer"></div>
      <a class="rail-item" (click)="logout()" title="Salir" style="cursor: pointer;">
        <ui-icon name="logout" [size]="18"></ui-icon>
      </a>
    </div>
    
    <!-- Panel (solo visible cuando no está colapsado) -->
    <div class="panel" *ngIf="!isCollapsed">
      <div class="user-summary">
        <img class="avatar" [src]="userAvatarUrl || '/assets/default-avatar.png'" alt="Avatar" (error)="onAvatarError($event)" />
        <div class="user-info">
          <div class="user-name">{{ userName || 'Usuario' }}</div>
          <div class="user-sub">Cuenta de cliente</div>
        </div>
      </div>
      <nav class="menu">
        <a routerLink="/client/explorar" routerLinkActive="active" (click)="onNav()">
          <ui-icon name="search" [size]="16"></ui-icon><span>Explorar</span>
        </a>
        <a routerLink="/client/reservas" routerLinkActive="active" (click)="onNav()">
          <ui-icon name="calendar" [size]="16"></ui-icon><span>Mis Reservas</span>
        </a>
                <a routerLink="/client/favoritos" routerLinkActive="active" (click)="onNav()">
                  <ui-icon name="heart" [size]="16"></ui-icon><span>Favoritos</span>
                </a>
                <a routerLink="/client/conversaciones" routerLinkActive="active" (click)="onNav()">
                  <ui-icon name="message" [size]="16"></ui-icon><span>Conversaciones</span>
                </a>
                <a routerLink="/client/perfil" routerLinkActive="active" (click)="onNav()">
                  <ui-icon name="user" [size]="16"></ui-icon><span>Mi Perfil</span>
                </a>
        <a routerLink="/client/wallet" routerLinkActive="active" (click)="onNav()">
          <ui-icon name="wallet" [size]="16"></ui-icon><span>Mi Billetera</span>
        </a>
        <a routerLink="/client/pagos" routerLinkActive="active" (click)="onNav()">
          <ui-icon name="card" [size]="16"></ui-icon><span>Métodos de Pago</span>
        </a>
        <a routerLink="/client/soporte" routerLinkActive="active" (click)="onNav()">
          <ui-icon name="help-circle" [size]="16"></ui-icon><span>Soporte</span>
        </a>
        <a routerLink="/client/configuracion" routerLinkActive="active" (click)="onNav()">
          <ui-icon name="settings" [size]="16"></ui-icon><span>Configuración</span>
        </a>
        <a (click)="switchToProvider()" style="cursor: pointer;">
          <ui-icon name="user" [size]="16"></ui-icon><span>Cambiar de cuenta</span>
        </a>
      </nav>
      <div class="footer">
        <a routerLink="/client/terminos" class="footer-link" (click)="onNav()">Términos y Condiciones</a>
        <theme-switch size="sm"></theme-switch>
        <a (click)="logout()" class="logout" style="cursor: pointer;">Salir</a>
      </div>
    </div>
  </aside>
  
  <!-- Overlay para móvil - después del sidebar para que no bloquee -->
  <div *ngIf="!isCollapsed && isMobile()" class="sidebar-overlay" (click)="isCollapsed = true; menuService.closeMenu()"></div>
  
  <main class="content">
    <app-topbar 
      [config]="topbarConfig"
      (hamburgerClick)="isCollapsed = !isCollapsed"
      (helpClick)="onHelpClick($event)"
      (notificationClick)="onNotificationClick($event)"
      (settingsClick)="onSettingsClick()">
    </app-topbar>
    <div class="main-slot">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>

<div class="switch-account-backdrop" *ngIf="switchModalVisible">
  <div class="switch-account-modal">
    <h3>¿Quieres cambiar tu cuenta a proveedor?</h3>
    <p>Al continuar iniciarás el proceso para ofrecer servicios en Adomi. Ten en cuenta:</p>
    <ul>
      <li>Se cerrarán tus vistas de cliente y deberás completar el perfil profesional.</li>
      <li>Necesitarás seleccionar un plan (puedes usar un código Fundador si tienes uno).</li>
      <li>Tus reservas activas como cliente permanecerán, pero ya no podrás crear nuevas.</li>
    </ul>
    <p class="switch-account-warning">Este cambio es reversible solo desde soporte. Asegúrate antes de continuar.</p>

    <div class="switch-account-alert" *ngIf="switchError">{{ switchError }}</div>

    <div class="switch-account-actions">
      <button type="button" class="btn-secondary" (click)="closeSwitchModal()" [disabled]="switchLoading">Cancelar</button>
      <button type="button" class="btn-primary" (click)="confirmSwitchToProvider()" [disabled]="switchLoading">
        {{ switchLoading ? 'Preparando cambio...' : 'Continuar' }}
      </button>
    </div>
  </div>
</div>
