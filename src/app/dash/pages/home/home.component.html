<div class="dash-home">
  <!-- Main Content -->
  <div class="dash-home__content">
    <!-- Header -->
    <app-inicio-header 
      [data]="headerData"
    (notificationClick)="onNotificationClick($event)"
      (publicProfileClick)="onPublicProfileClick()">
    </app-inicio-header>

  <div class="container-pro">
    <div class="container-pro-1">
        <section
          class="golden-invite"
          id="golden-invite-section"
          [class.golden-invite--collapsed]="!inviteCardExpanded"
        >
          <button type="button" class="golden-invite__header" (click)="toggleInviteCard()">
            <div class="golden-invite__heading">
              <div class="golden-invite__title-row">
                <h3>Invitaciones Doradas</h3>
                <span class="golden-invite__badge" *ngIf="isPioneerUnlocked">
                  <span class="golden-invite__badge-icon">üõ°Ô∏è</span>
                  Pionero activo
                </span>
                <span
                  class="golden-invite__info"
                  [attr.data-tooltip]="pioneerTooltip"
                  [attr.title]="pioneerTooltip"
                  aria-hidden="true"
                >
                  ?
                </span>
              </div>
              <p *ngIf="!isPioneerUnlocked">Comparte tus invitaciones para desbloquear el estatus <strong>Pionero</strong>.</p>
              <p *ngIf="isPioneerUnlocked" class="golden-invite__message">
                ¬°Felicidades! Alcanzaste el estatus <strong>Pionero</strong>
                <ng-container *ngIf="pioneerUnlockedLabel">el {{ pioneerUnlockedLabel }}</ng-container>.
                Ahora tus servicios aparecen primero a los clientes que exploran Adomi.
              </p>
            </div>
            <div class="golden-invite__metrics">
              <div class="metric">
                <span class="label">Disponibles</span>
                <span class="value">{{ remainingInvites() }}</span>
              </div>
              <div class="metric">
                <span class="label">Verificadas</span>
                <span class="value" [ngClass]="{'value--goal-met': (inviteSummary?.counts?.verified || 0) >= (inviteSummary?.quota || 3)}">
                  {{ inviteSummary?.counts?.verified || 0 }}
                </span>
              </div>
              <div class="metric">
                <span class="label">Meta</span>
                <span class="value" [ngClass]="{'value--goal-met': (inviteSummary?.counts?.verified || 0) >= (inviteSummary?.quota || 3)}">
                  {{ inviteSummary?.quota || 3 }}
                </span>
              </div>
              <span class="golden-invite__toggle" [class.golden-invite__toggle--open]="inviteCardExpanded">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </span>
            </div>
          </button>

          <div class="golden-invite__body" *ngIf="inviteCardExpanded">
            <form class="golden-invite__form" (ngSubmit)="onCreateInvite()">
              <div class="form-grid">
                <label class="form-field">
                  <span>Correo electr√≥nico</span>
                  <input type="email" name="inviteEmail" [(ngModel)]="inviteEmail" placeholder="colega@oficio.cl" autocomplete="email">
                </label>
                <label class="form-field">
                  <span>Tel√©fono (opcional)</span>
                  <input type="tel" name="invitePhone" [(ngModel)]="invitePhone" placeholder="+56 9 1234 5678" autocomplete="tel">
                </label>
                <label class="form-field">
                  <span>Nombre (opcional)</span>
                  <input type="text" name="inviteName" [(ngModel)]="inviteName" placeholder="Nombre del colega" autocomplete="name">
                </label>
              </div>
              <div class="form-actions">
                <button type="submit" [disabled]="inviteSubmitting || remainingInvites() === 0">
                  {{ inviteSubmitting ? 'Creando‚Ä¶' : 'Enviar invitaci√≥n' }}
                </button>
                <span class="form-hint">Necesitas al menos correo o tel√©fono para generar la invitaci√≥n.</span>
              </div>
            </form>

            <div class="golden-invite__feedback">
              <p class="error" *ngIf="inviteError">{{ inviteError }}</p>
              <p class="success" *ngIf="inviteSuccessMessage">{{ inviteSuccessMessage }}</p>
            </div>

            <div class="golden-invite__table">
              <div class="table-header">
                <h4>Historial de invitaciones</h4>
                <button type="button" class="refresh-btn" (click)="loadInviteData(true)">
                  Actualizar
                </button>
              </div>
              <div class="table-body" *ngIf="inviteLoading">
                <p>Cargando invitaciones‚Ä¶</p>
              </div>
              <div class="table-body" *ngIf="!inviteLoading && invites.length === 0">
                <p>A√∫n no has enviado invitaciones. Empieza invitando a tu primer colega.</p>
              </div>
              <table *ngIf="!inviteLoading && invites.length > 0">
                <thead>
                  <tr>
                    <th>Invitado</th>
                    <th>Contacto</th>
                    <th>Estado</th>
                    <th>Creada</th>
                    <th>Enlace</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let invite of invites; trackBy: trackInvite">
                    <td>
                      <div class="cell-main">
                        <strong>{{ invite.invitee_name || 'Invitaci√≥n sin nombre' }}</strong>
                        <span class="code">C√≥digo: {{ invite.invite_code }}</span>
                      </div>
                    </td>
                    <td>
                      <div class="cell-secondary">
                        <span *ngIf="invite.invitee_email">{{ invite.invitee_email }}</span>
                        <span *ngIf="invite.invitee_phone">{{ invite.invitee_phone }}</span>
                      </div>
                    </td>
                    <td>
                      <span class="status-chip" [ngClass]="getInviteStatusClass(invite.status)">
                        {{ getInviteStatusLabel(invite.status) }}
                      </span>
                    </td>
                    <td>
                      <div class="cell-secondary">
                        {{ invite.created_at | date:'dd MMM' }}
                        <span *ngIf="invite.expires_at">‚Ä¢ expira {{ invite.expires_at | date:'dd MMM' }}</span>
                      </div>
                    </td>
                    <td>
                      <div class="cell-actions">
                        <button type="button" (click)="copyShareUrl(invite)">Copiar enlace</button>
                        <button type="button" (click)="shareViaWhatsApp(invite)">WhatsApp</button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <section *ngIf="showTbkUrgentBanner" class="tbk-alert" role="alert">
          <div class="tbk-alert__content">
            <h3 class="tbk-alert__title">Activa Webpay Mall para recibir pagos con tarjeta</h3>
            <p class="tbk-alert__text">
              Completa la configuraci√≥n de Transbank para evitar bloqueos en tus reservas y aseg√∫rate de que tus clientes puedan pagarte.
            </p>
          </div>
          <button type="button" class="tbk-alert__cta" (click)="goToTbkSetup()">
            Configurar ahora
          </button>
        </section>

        <section *ngIf="showAvailabilityAlert" class="availability-alert" role="alert">
          <div class="availability-alert__content">
            <h3 class="availability-alert__title">Publica tus horarios para recibir nuevas reservas</h3>
            <p class="availability-alert__text">
              A√∫n no tienes bloques de disponibilidad activos. Mientras no los configures, ning√∫n cliente podr√° agendarte desde el marketplace.
            </p>
          </div>
          <button type="button" class="availability-alert__cta" (click)="goToAvailabilitySettings()">
            Configurar horarios
          </button>
        </section>
        <section *ngIf="showAnalyticsUpgradeCta" class="analytics-upgrade-card" role="region" aria-label="Mejora tu plan para anal√≠ticas">
          <div class="analytics-upgrade-card__content">
            <h3>Desbloquea estad√≠sticas avanzadas</h3>
            <p>
              Tu plan fundador incluye m√©tricas b√°sicas. Mejora para ver reportes completos, desglose semanal y rese√±as extendidas en tu panel.
            </p>
          </div>
          <button type="button" class="analytics-upgrade-card__cta" (click)="goToAnalyticsUpgrade()">
            Mejorar plan
          </button>
        </section>
        <!-- Dashboard Components -->
        <app-inicio-solicitudes 
        [data]="solicitudesData"
        (acceptClick)="onAcceptClick($event)"
        (declineClick)="onDeclineClick($event)"
        (reservaAccepted)="onReservaAccepted($event)"
        (reservaRejected)="onReservaRejected($event)">
       </app-inicio-solicitudes>

       <!-- Citas pagadas (pr√≥ximas): para saber altiro a cu√°l ir primero -->
       <section class="paid-upcoming">
        <div class="paid-upcoming__header">
          <div>
            <h3 class="paid-upcoming__title">Citas pagadas (pr√≥ximas)</h3>
            <p class="paid-upcoming__subtitle">Ordenadas por fecha y hora. La primera es tu pr√≥xima prioridad.</p>
          </div>
          <button type="button" class="paid-upcoming__cta" (click)="goToAgenda()">Ver en Agenda</button>
        </div>

        <p class="paid-upcoming__error" *ngIf="paidUpcomingError">{{ paidUpcomingError }}</p>
        <p class="paid-upcoming__loading" *ngIf="paidUpcomingLoading">Cargando citas pagadas‚Ä¶</p>

        <div class="paid-upcoming__empty" *ngIf="!paidUpcomingLoading && !paidUpcomingError && paidUpcoming.length === 0">
          No tienes citas pagadas pr√≥ximas.
        </div>

        <div class="paid-upcoming__list" *ngIf="!paidUpcomingLoading && paidUpcoming.length > 0">
          <div class="paid-upcoming__card" *ngFor="let ap of paidUpcoming; let i = index">
            <div class="paid-upcoming__row">
              <div class="paid-upcoming__avatar" [class.paid-upcoming__avatar--fallback]="!ap.clientAvatar">
                <img [src]="ap.clientAvatar || 'assets/default-avatar.png'" [alt]="ap.clientName" />
              </div>
              <div class="paid-upcoming__main">
                <div class="paid-upcoming__line1">
                  <span class="paid-upcoming__badge" [class.paid-upcoming__badge--first]="i === 0">{{ i === 0 ? 'PRIMERA' : 'PAGADA' }}</span>
                  <strong class="paid-upcoming__service">{{ ap.service }}</strong>
                </div>
                <div class="paid-upcoming__line2">
                  con <span class="paid-upcoming__client">{{ ap.clientName }}</span>
                </div>
                <div class="paid-upcoming__meta">
                  <span>{{ ap.when }}</span> ‚Ä¢ <span>{{ ap.time }}</span>
                </div>
                <div class="paid-upcoming__meta paid-upcoming__meta--location" *ngIf="ap.location">
                  üìç {{ ap.location }}
                </div>
              </div>
            </div>
          </div>
        </div>
       </section>

       <app-inicio-proxima-cita 
        *ngIf="proximaCitaData"
        [data]="proximaCitaData"
        (viewDetailsClick)="onViewDetailsClick($event)"
        (citaAction)="onCitaAction($event)"
        (citaCancel)="onCitaCancel($event)">
       </app-inicio-proxima-cita>
       
    </div>
    <div class="ingresos-container">
      <app-inicio-ingresos-mes 
        [data]="ingresosData"
        (viewReportClick)="onViewReportClick($event)"
        (navigateToReport)="onNavigateToReport($event)">
      </app-inicio-ingresos-mes>
      
      <app-inicio-ingresos-dia 
        [data]="ingresosDiaData"
        (viewReportClick)="onViewDayReportClick($event)"
        (navigateToReport)="onNavigateToReport($event)">
      </app-inicio-ingresos-dia>
      <div class="release-summary">
        <div class="release-summary__card">
          <span class="label">Pendiente de pago</span>
          <span class="value">{{ releaseSummary.pending }}</span>
        </div>
        <div class="release-summary__card">
          <span class="label">Pagadas (por atender)</span>
          <span class="value">{{ releaseSummary.releasable }}</span>
        </div>
        <div class="release-summary__card">
          <span class="label">Pagadas este mes</span>
          <span class="value">{{ releaseSummary.released }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
