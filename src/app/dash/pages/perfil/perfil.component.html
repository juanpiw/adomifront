<div class="perfil-trabajador">
  <!-- Tabs de navegación -->
  <app-tabs-perfil 
    [activeTab]="activeTab"
    (tabChange)="onTabChange($event)">
  </app-tabs-perfil>

  <!-- Contenido del tab activo -->
  <div class="perfil-trabajador__content">
    
    <!-- Tab: Perfil Público -->
    <div *ngIf="activeTab === 'perfil-publico'" class="perfil-trabajador__tab-content">
      <!-- Progreso del perfil -->
      <app-progress-perfil>
      </app-progress-perfil>

      <!-- Información básica -->
      <app-info-basica 
        [info]="basicInfo"
        [saving]="savingBasicInfo"
        [hasChanges]="basicInfoHasChanges"
        (infoChange)="onBasicInfoChange($event)"
        (saveInfo)="onSaveBasicInfo($event)">
      </app-info-basica>

      <!-- Fotos de perfil -->
      <app-seccion-fotos 
        (changeProfilePhoto)="onProfilePhotoChange($event)"
        (changeCoverPhoto)="onCoverPhotoChange($event)">
      </app-seccion-fotos>

      <!-- Sobre mí -->
      <app-sobre-mi 
        [bio]="bio"
        (bioChange)="onBioChange($event)">
      </app-sobre-mi>

      <!-- Mis servicios -->
      <app-mis-servicios 
        #misServiciosComponent
        [services]="services"
        (editService)="onEditService($event)"
        (deleteService)="onDeleteService($event)"
        (addService)="onAddService()">
      </app-mis-servicios>

      <!-- Portafolio -->
      <app-portafolio 
        [images]="portfolioImages"
        [maxImages]="10"
        (addImage)="onAddPortfolioImage()"
        (addVideo)="onAddPortfolioVideo()"
        (deleteImage)="onDeletePortfolioImage($event)">
      </app-portafolio>

      <!-- Ubicación y Disponibilidad -->
      <app-ubicacion-disponibilidad 
        [settings]="locationSettings"
        (settingsChange)="onLocationSettingsChange($event)"
        (addCoverageZone)="onAddCoverageZone($event)"
        (removeCoverageZone)="onRemoveCoverageZone($event)">
      </app-ubicacion-disponibilidad>

      <!-- Botón para guardar cambios del perfil público -->
      <div class="perfil-publico__actions">
        <ui-button variant="primary" (click)="savePublicProfile()" [loading]="savingPublicProfile">
          Guardar cambios del perfil
        </ui-button>
      </div>
    </div>

    <!-- Tab: Verificación -->
    <div *ngIf="activeTab === 'verificacion'" class="perfil-trabajador__tab-content">
      <app-verificacion-perfil></app-verificacion-perfil>
    </div>

    <!-- Tab: Configuración -->
    <div *ngIf="activeTab === 'configuracion'" class="perfil-trabajador__tab-content">
      <!-- Configuración del Perfil de la Aplicación -->
      <section class="configuracion-app">
        <h2 class="configuracion-app__title">Configuración del Perfil de la Aplicación</h2>
        <p class="configuracion-app__subtitle">Estas configuraciones son privadas y solo las ves tú. No afectan tu perfil público.</p>
        
        <div class="configuracion-app__content">
          <div class="configuracion-app__avatar">
            <avatar-uploader [(src)]="avatar"></avatar-uploader>
          </div>
          
          <div class="configuracion-app__fields">
            <ui-input label="Nombre" placeholder="Tu nombre" [(value)]="name"></ui-input>
            <ui-input label="Teléfono" placeholder="Ej: +56 9 1234 5678" [(value)]="phone"></ui-input>
            
            <div class="configuracion-app__field">
              <label class="configuracion-app__label">Idioma</label>
              <language-select [(value)]="lang"></language-select>
            </div>
            
            <div class="configuracion-app__field">
              <label class="configuracion-app__label">Notificaciones</label>
              <notification-toggle [(email)]="emailNoti" [(push)]="pushNoti"></notification-toggle>
            </div>
          </div>
          
          <div class="configuracion-app__actions">
            <ui-button variant="primary" (click)="save()">Guardar cambios</ui-button>
          </div>
        </div>
      </section>

      <!-- Horario y Disponibilidad -->
      <app-horario-disponibilidad 
        [schedule]="weeklySchedule"
        (scheduleChange)="onScheduleChange($event)"
        (addTimeBlock)="onAddTimeBlock($event)"
        (removeTimeBlock)="onRemoveTimeBlock($event)"
        (toggleDay)="onToggleDay($event)">
      </app-horario-disponibilidad>

      <!-- Excepciones y Feriados -->
      <app-excepciones-feriados 
        [exceptions]="exceptions"
        (exceptionsChange)="onExceptionsChange($event)"
        (addException)="onAddException($event)"
        (removeException)="onRemoveException($event)">
      </app-excepciones-feriados>
    </div>

    <!-- Tab: Ver Perfil Público -->
    <div *ngIf="activeTab === 'ver-perfil-publico'" class="perfil-trabajador__tab-content">
      <div class="ver-perfil-publico">
        <div class="ver-perfil-publico__header">
          <h2 class="ver-perfil-publico__title">Vista Previa del Perfil Público</h2>
          <p class="ver-perfil-publico__subtitle">Así es como los clientes verán tu perfil</p>
        </div>
        
        <div class="ver-perfil-publico__preview">
          <div class="profile-preview">
            <!-- Header del perfil -->
            <div class="profile-preview__header">
              <div class="profile-preview__avatar">
                <img [src]="avatar || 'https://placehold.co/120x120/C7D2FE/4338CA?text=ET'" alt="Avatar">
              </div>
              <div class="profile-preview__info">
                <h1 class="profile-preview__name">{{ basicInfo.fullName }}</h1>
                <p class="profile-preview__title">{{ basicInfo.professionalTitle }}</p>
                <p class="profile-preview__location">{{ basicInfo.mainCommune }}</p>
                <div class="profile-preview__rating">
                  <span class="rating-stars">⭐⭐⭐⭐⭐</span>
                  <span class="rating-text">4.9 (127 reseñas)</span>
                </div>
              </div>
            </div>

            <!-- Información básica -->
            <div class="profile-preview__section">
              <h3>Sobre mí</h3>
              <p>{{ bio }}</p>
            </div>

            <!-- Servicios -->
            <div class="profile-preview__section">
              <h3>Mis Servicios</h3>
              <div class="services-preview">
                <div *ngFor="let service of services" class="service-preview">
                  <div class="service-preview__info">
                    <h4>{{ service.name }}</h4>
                    <p>{{ service.duration_minutes }} min</p>
                  </div>
                  <div class="service-preview__price">
                    ${{ service.price | number }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Portafolio -->
            <div class="profile-preview__section" *ngIf="portfolioImages.length > 0">
              <h3>Portafolio</h3>
              <div class="portfolio-carousel">
                <div class="portfolio-carousel__container" [style.transform]="'translateX(' + currentSlide * -100 + '%)'">
                  <div *ngFor="let image of portfolioImages; let i = index" 
                       class="portfolio-carousel__slide"
                       [class.portfolio-carousel__slide--active]="i === currentSlide">
                    <div class="portfolio-carousel__item">
                      <img [src]="image.url" [alt]="image.alt">
                      <div class="portfolio-carousel__overlay">
                        <div class="portfolio-carousel__content">
                          <h4>{{ image.alt }}</h4>
                          <p>Ver detalles</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Controles del carrusel -->
                <div class="portfolio-carousel__controls">
                  <button class="portfolio-carousel__btn portfolio-carousel__btn--prev" 
                          (click)="previousSlide()"
                          [disabled]="currentSlide === 0">
                    <ui-icon name="chevron-left"></ui-icon>
                  </button>
                  <button class="portfolio-carousel__btn portfolio-carousel__btn--next" 
                          (click)="nextSlide()"
                          [disabled]="currentSlide === portfolioImages.length - 1">
                    <ui-icon name="chevron-right"></ui-icon>
                  </button>
                </div>
                
                <!-- Indicadores -->
                <div class="portfolio-carousel__indicators">
                  <button *ngFor="let image of portfolioImages; let i = index" 
                          class="portfolio-carousel__indicator"
                          [class.portfolio-carousel__indicator--active]="i === currentSlide"
                          (click)="goToSlide(i)">
                  </button>
                </div>
              </div>
            </div>

            <!-- Botón de reserva -->
            <div class="profile-preview__actions">
              <button class="btn-reserve">Reservar Cita</button>
            </div>
          </div>
        </div>

        <div class="ver-perfil-publico__actions">
          <ui-button variant="primary" (click)="openPublicProfile()">
            Abrir Perfil Público
          </ui-button>
          <ui-button variant="secondary" (click)="shareProfile()">
            Compartir Perfil
          </ui-button>
        </div>
      </div>
    </div>

  </div>

  <!-- Modal de crear/editar servicio -->
  <app-modal-crear-servicio
    [isOpen]="showServiceModal"
    [editingService]="editingService"
    [saving]="savingService"
    (close)="onCloseServiceModal()"
    (save)="onSaveService($event)">
  </app-modal-crear-servicio>
</div>
