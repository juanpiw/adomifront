<div class="agenda-container">
  <!-- Navegaci√≥n de la agenda -->
  <nav class="agenda-nav">
    <button 
      class="agenda-nav__button"
      [class.agenda-nav__button--active]="currentView === 'dashboard'"
      (click)="setView('dashboard')">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z" />
      </svg>
      Panel de Control
    </button>
    
    <button 
      class="agenda-nav__button"
      [class.agenda-nav__button--active]="currentView === 'calendar'"
      (click)="setView('calendar')"
      style="position: relative;">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span>Agenda (Citas)</span>
      <!-- üîî Badge rojo de citas pendientes -->
      <span *ngIf="scheduledAppointmentsCount > 0" class="agenda-nav__badge">
        {{ scheduledAppointmentsCount }}
      </span>
    </button>
    
    <button 
      class="agenda-nav__button"
      [class.agenda-nav__button--active]="currentView === 'config'"
      (click)="setView('config')">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      Configuraci√≥n
    </button>
  </nav>

  <!-- Contenido del dashboard -->
  <div *ngIf="currentView === 'dashboard'" class="agenda-content">
    <div class="agenda-content__main">
      <!-- Dashboard Resumen -->
      <app-dashboard-resumen 
        [metrics]="dashboardMetrics"
        [loading]="loading">
      </app-dashboard-resumen>

      <!-- Panel: Citas por pagar (esperan c√≥digo) -->
      <div *ngIf="showPaidAwaitingPanel" class="paid-awaiting">
        <h3 class="paid-awaiting__title">Citas por pagar (esperan verificaci√≥n de c√≥digo)</h3>
        <div *ngIf="paidAwaitingAppointments.length === 0" class="paid-awaiting__empty">
          No tienes citas pagadas esperando verificaci√≥n.
        </div>
        <div *ngFor="let ap of paidAwaitingAppointments" class="paid-awaiting__card">
          <div class="paid-awaiting__row">
            <div class="paid-awaiting__col">
              <p class="paid-awaiting__service">{{ ap.service_name || 'Servicio' }}</p>
              <p class="paid-awaiting__meta">Cliente: {{ ap.client_name || '‚Äî' }}</p>
              <p class="paid-awaiting__meta">Fecha: {{ formatDate(ap.date) }} ¬∑ {{ formatTime(ap.start_time) }}</p>
            </div>
            <div class="paid-awaiting__actions">
              <button class="paid-awaiting__btn" (click)="openVerifyModal(ap)">Verificar C√≥digo</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Dashboard Gr√°fico -->
      <app-dashboard-grafico 
        [loading]="loading">
      </app-dashboard-grafico>
    </div>
  </div>

  <!-- Contenido del calendario -->
  <div *ngIf="currentView === 'calendar'" class="agenda-content agenda-content--calendar">
    <div class="agenda-content__calendar">
      <!-- Calendario Mensual -->
      <app-calendar-mensual 
        [events]="calendarEvents"
        [loading]="loading"
        (dateSelected)="onDateSelected($event)"
        (newAppointment)="onNewAppointment()"
        (previousMonth)="onPreviousMonth()"
        (nextMonth)="onNextMonth()">
      </app-calendar-mensual>
    </div>

    <div class="agenda-content__sidebar">
      <!-- Detalle del D√≠a -->
      <app-day-detail 
        [selectedDate]="selectedDate"
        [appointments]="dayAppointments"
        [loading]="loading"
        (appointmentClick)="onAppointmentClick($event)"
        (newAppointment)="onNewAppointmentForDay($event)"
        (citaCreated)="onDayCitaCreated($event)"
        (espacioBloqueado)="onEspacioBloqueado($event)"
        (confirmAppointment)="onConfirmAppointment(+$any($event))"
        (deleteAppointment)="onDeleteAppointment(+$any($event))">
        <ng-template #appointmentActionsTemplate let-appointment="appointment">
          <button *ngIf="appointment.status === 'scheduled'"
                  class="day-detail__action-btn day-detail__action-btn--confirm"
                  (click)="onConfirmAppointment(+appointment.id)">
            Confirmar
          </button>
        </ng-template>
      </app-day-detail>
    </div>
  </div>

  <!-- Contenido de configuraci√≥n -->
  <div *ngIf="currentView === 'config'" class="agenda-content">
    <div class="agenda-content__main">
      <!-- Configuraci√≥n de Horarios -->
      <app-horarios-config 
        [timeBlocks]="timeBlocks"
        [loading]="loading"
        (addTimeBlock)="onAddTimeBlock($event)"
        (removeTimeBlock)="onRemoveTimeBlock($event)"
        (updateTimeBlock)="onUpdateTimeBlock($event)">
      </app-horarios-config>

      <div class="flex justify-end mt-4">
        <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg"
                [disabled]="loading"
                (click)="onSaveSchedule()">
          {{ loading ? 'Guardando...' : 'Guardar Horario' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de verificaci√≥n de servicio -->
<ui-modal-verificar-servicio
  *ngIf="isVerificationModalOpen"
  [isOpen]="isVerificationModalOpen"
  [appointment]="selectedPaidAppointment"
  [verifying]="verifying"
  [errorMessage]="verificationError"
  [remainingAttempts]="remainingAttempts"
  (verified)="onVerificationSubmit($event)"
  (cancel)="onVerificationCancel()"
></ui-modal-verificar-servicio>




