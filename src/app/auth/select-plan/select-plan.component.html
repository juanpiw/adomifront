<div class="plan-selection-container">
  <div class="account-switch-banner" *ngIf="accountSwitchInProgress">
    <div class="banner-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.73-.626 1.18-.734l.54-1.636c.26-1.004-.322-2.016-1.34-2.28zM11.42 15.17L5.877 21m6.46-6.46l-1.127-1.127a4.5 4.5 0 00-6.364-6.364l-1.127 1.127" />
      </svg>
    </div>
    <div>
      <h4>Estás convirtiendo tu cuenta en proveedor</h4>
      <p>Completa tu plan para habilitar el dashboard profesional y empezar a recibir clientes.</p>
    </div>
  </div>

  <div class="pricing-v2">
    <div class="pricing-v2__header" id="mainHeader">
      <h1 class="pricing-v2__title">Elige cómo quieres crecer</h1>
      <p class="pricing-v2__subtitle">Reduce tus comisiones pagando una suscripción mensual o empieza gratis.</p>

      <div class="status-banner status-banner--info" *ngIf="pendingActivation">
        <strong>Tu pago aún se está confirmando.</strong>
        <span>Si ya pagaste, espera unos segundos y vuelve a intentarlo. Si cancelaste, puedes seleccionar otro plan.</span>
      </div>

      <div class="pricing-v2__billing-toggle billing-toggle-wrapper" role="group" aria-label="Seleccionar periodicidad">
        <button
          type="button"
          class="billing-label"
          [class.active]="!isAnnual"
          (click)="setBilling(false)"
        >
          Mensual
        </button>

        <button
          type="button"
          class="toggle-switch"
          [class.checked]="isAnnual"
          (click)="toggleBilling()"
          aria-label="Cambiar entre mensual y anual"
        >
          <span class="toggle-slider"></span>
        </button>

        <button
          type="button"
          class="billing-label"
          [class.active]="isAnnual"
          (click)="setBilling(true)"
        >
          Anual
        </button>

        <span class="savings-badge">2 meses GRATIS</span>
      </div>
    </div>

    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando planes...</p>
    </div>

    <div *ngIf="error" class="error">
      <p>{{ error }}</p>
      <button class="btn-primary" (click)="loadPlans()">Reintentar</button>
    </div>

    <div *ngIf="!loading && !error" class="plans-grid pricing-v2__grid" id="plansGrid">
      <!-- Fundador (mismo HTML que landing) -->
      <div class="plan-card plan-card--founder">
        <div class="founder-badge">¡Limitado!</div>
        <div class="card-header">
          <h3 class="plan-name">Fundador</h3>
          <p class="plan-desc">Acceso exclusivo "Pioneros". Beneficios especiales para primeros usuarios.</p>
        </div>

        <div class="card-pricing">
          <div class="price-value">
            <span class="amount">$0</span>
            <span class="period">/6 meses</span>
          </div>
          <div class="commission-box">
            <span class="comm-label">Tu Comisión</span>
            <span class="comm-value">0%</span>
          </div>
        </div>

        <ul class="features-list">
          <li class="enabled">
            <span class="material-icon icon">check_circle</span>
            <span><strong>Servicios Ilimitados</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">check_circle</span>
            <span>Prioridad Búsquedas Locales</span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">check_circle</span>
            <span>Soporte Directo del Equipo</span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">auto_awesome</span>
            <span>Acceso funciones Beta</span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">payments</span>
            <span>Pagos en Efectivo Habilitados</span>
          </li>
        </ul>

        <div class="founder-input-area">
          <form (ngSubmit)="onFounderRequestSubmit()" class="founder-request-form" novalidate>
            <input
              type="email"
              [(ngModel)]="founderEmail"
              name="founderEmail"
              placeholder="Tu correo electrónico"
              required
              autocomplete="email"
              class="founder-request-input"
            />

            <button type="submit" class="founder-request-button btn-founder">
              Quiero ser de los primeros
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
            </button>
          </form>
        </div>
      </div>

      <!-- PLAN STARTER (mismo HTML que Home) -->
      <div class="plan-card">
        <div class="card-header">
          <h3 class="plan-name">Starter</h3>
          <p class="plan-desc">Ideal para empezar sin costos fijos. Pagas solo cuando ganas.</p>
        </div>

        <div class="card-pricing">
          <div class="price-value">
            <span class="amount">Gratis</span>
          </div>
          <div class="commission-box high-comm">
            <span class="comm-label">Tu Comisión</span>
            <span class="comm-value">15%</span>
          </div>
        </div>

        <ul class="features-list">
          <li class="disabled">
            <span class="material-icon icon">cancel</span>
            <span>Pagos en Efectivo <span class="tooltip-hint">(Solo tarjeta)</span></span>
          </li>
          <li class="disabled">
            <span class="material-icon icon">cancel</span>
            <span>Sistema de Cotizaciones</span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">photo_library</span>
            <span>Portafolio: <strong>5 items</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">analytics</span>
            <span>Analytics: <strong>Básico</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">rocket_launch</span>
            <span>Visibilidad: <strong>Estándar</strong></span>
          </li>
        </ul>

        <button type="button" class="btn-select btn-outline" (click)="selectTier('starter')">Empezar Gratis</button>
      </div>

      <!-- PLAN PRO (mismo HTML que Home) -->
      <div class="plan-card recommended">
        <div class="badge-recommended">Más Popular</div>
        <div class="card-header">
          <h3 class="plan-name">Pro</h3>
          <p class="plan-desc">Para profesionales activos. Aumenta tu margen de ganancia.</p>
        </div>

        <div class="card-pricing">
          <div class="price-value">
            <span class="currency">$</span>
            <span class="amount">{{ proPrice }}</span>
            <span class="period">{{ billingPeriodLabel }}</span>
          </div>
          <div class="commission-box low-comm">
            <span class="comm-label">Tu Comisión</span>
            <span class="comm-value">7%</span>
          </div>
        </div>

        <ul class="features-list">
          <li class="enabled">
            <span class="material-icon icon">check_circle</span>
            <span><strong>Pagos en Efectivo</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">check_circle</span>
            <span>Sistema de Cotizaciones</span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">photo_library</span>
            <span>Portafolio: <strong>25 items</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">analytics</span>
            <span>Analytics: <strong>Avanzado</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">rocket_launch</span>
            <span>Visibilidad: <strong>Alta</strong></span>
          </li>
        </ul>

        <button type="button" class="btn-select btn-primary" (click)="selectTier('pro')">Elegir Pro</button>
      </div>

      <!-- PLAN SCALE (mismo HTML que Home) -->
      <div class="plan-card">
        <div class="card-header">
          <h3 class="plan-name">Scale</h3>
          <p class="plan-desc">Para agencias y alto volumen. Máxima rentabilidad.</p>
        </div>

        <div class="card-pricing">
          <div class="price-value">
            <span class="currency">$</span>
            <span class="amount">{{ scalePrice }}</span>
            <span class="period">{{ billingPeriodLabel }}</span>
          </div>
          <div class="commission-box low-comm">
            <span class="comm-label">Tu Comisión</span>
            <span class="comm-value">5%</span>
          </div>
        </div>

        <ul class="features-list">
          <li class="enabled">
            <span class="material-icon icon">check_circle</span>
            <span>Pagos en Efectivo</span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">check_circle</span>
            <span>Cotizaciones <strong>Marca Blanca</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">photo_library</span>
            <span>Portafolio: <strong>Ilimitado</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">analytics</span>
            <span>Analytics + <strong>Exportar CSV</strong></span>
          </li>
          <li class="enabled">
            <span class="material-icon icon">rocket_launch</span>
            <span>Visibilidad: <strong>Top</strong></span>
          </li>
        </ul>

        <button type="button" class="btn-select btn-outline" (click)="selectTier('scale')">Elegir Scale</button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !error && requiresPaymentSelection()" class="payment-methods">
    <h3>Selecciona cómo quieres pagar</h3>
    <p>Elige la pasarela de pago que prefieras para completar tu suscripción.</p>

    <div class="payment-options">
      <label
        class="payment-option"
        *ngFor="let method of paymentMethods"
        [class.selected]="paymentMethod === method.id"
      >
        <input
          type="radio"
          name="paymentMethod"
          [value]="method.id"
          [checked]="paymentMethod === method.id"
          (change)="onPaymentMethodChange(method.id)"
        />
        <div class="payment-option__body">
          <div class="payment-option__header">
            <span class="payment-option__title">{{ method.label }}</span>
            <span *ngIf="method.badge" class="payment-option__badge">{{ method.badge }}</span>
          </div>
          <p class="payment-option__description">{{ method.description }}</p>
        </div>
      </label>
    </div>
  </div>

  <div *ngIf="!loading && !error" class="actions">
    <button class="btn-secondary" type="button" (click)="goBack()" [disabled]="promoActivating">
      Volver
    </button>
    <button
      class="btn-primary"
      type="button"
      *ngIf="!isPromoActive()"
      [disabled]="!selectedPlan"
      (click)="continueToPayment()"
    >
      {{
        selectedPlan
          ? (paymentMethod === 'tbk' && requiresPaymentSelection()
            ? 'Pagar con Webpay Plus'
            : 'Pagar con Stripe')
          : 'Selecciona un plan'
      }}
    </button>
  </div>
</div>
