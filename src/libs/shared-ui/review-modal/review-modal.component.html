<div class="review-modal" *ngIf="isOpen">
  <div class="review-modal__overlay" (click)="onClose()"></div>
  
  <div class="review-modal__content">
    
    <!-- Vista principal de reseña -->
    <div *ngIf="!showSuccessView" class="review-modal__main">
      
      <!-- Header -->
      <div class="review-modal__header">
        <h2 class="review-modal__title">Califica tu experiencia</h2>
        <button class="review-modal__close" (click)="onClose()">
          <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Contenido -->
      <div class="review-modal__body">
        <p class="review-modal__question">
          ¿Qué tal fue el servicio de <span class="review-modal__worker-name">{{ workerName }}</span>?
        </p>
        
        <!-- Estrellas -->
        <div class="review-modal__stars" (mouseleave)="onStarLeave()">
          <button 
            *ngFor="let star of getStars()"
            class="review-modal__star"
            [class.review-modal__star--active]="isStarActive(star)"
            (click)="setRating(star)"
            (mouseenter)="onStarHover(star)"
            type="button"
            [title]="star + ' estrella' + (star > 1 ? 's' : '')">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
            </svg>
          </button>
        </div>

        <!-- Comentario -->
        <textarea 
          class="review-modal__comment"
          [(ngModel)]="comment"
          placeholder="Escribe un comentario (opcional)..."
          rows="4">
        </textarea>
      </div>

      <!-- Footer -->
      <div class="review-modal__footer">
        <button 
          class="review-modal__submit"
          [class.review-modal__submit--disabled]="rating === 0 || isSubmitting"
          [disabled]="rating === 0 || isSubmitting"
          (click)="onSubmit()">
          <span *ngIf="!isSubmitting">Enviar Reseña</span>
          <span *ngIf="isSubmitting">Enviando...</span>
        </button>
      </div>
    </div>

    <!-- Vista de éxito -->
    <div *ngIf="showSuccessView" class="review-modal__success">
      <div class="review-modal__success-icon">
        <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
      
      <h2 class="review-modal__success-title">¡Gracias por tu opinión!</h2>
      <p class="review-modal__success-message">
        Tu reseña ayuda a otros miembros de la comunidad a tomar mejores decisiones.
      </p>
      
      <button 
        class="review-modal__success-button"
        (click)="onCloseSuccess()">
        Cerrar
      </button>
    </div>

    <!-- Vista de error -->
    <div *ngIf="showErrorView" class="review-modal__error">
      <div class="review-modal__error-icon">
        <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </div>
      
      <h2 class="review-modal__error-title">Error al enviar reseña</h2>
      <p class="review-modal__error-message">
        {{ errorMessage || 'No se pudo enviar tu reseña. Por favor, inténtalo de nuevo.' }}
      </p>
      
      <div class="review-modal__error-actions">
        <button 
          class="review-modal__error-button review-modal__error-button--secondary"
          (click)="onCloseError()">
          Cerrar
        </button>
        <button 
          class="review-modal__error-button review-modal__error-button--primary"
          (click)="onCloseError()">
          Intentar de nuevo
        </button>
      </div>
    </div>
    
  </div>
</div>
