<!-- Map Card Container -->
<section class="flex-grow flex overflow-hidden rounded-2xl border border-slate-200 shadow-sm" [style.height]="height">
  
  <!-- Left Panel: Professionals List -->
  <aside class="w-1/3 bg-white p-4 overflow-y-auto results-list">
    <h3 class="text-lg font-bold text-slate-800 mb-4">{{ professionals.length }} {{ title.toLowerCase() }}</h3>
    
    <!-- Highlighted Professional Card -->
    <div *ngIf="highlightedProfessional" 
         class="p-4 rounded-2xl border-2 border-indigo-500 bg-indigo-50 mb-4">
      <div class="flex items-start">
        <img [src]="highlightedProfessional.avatar" 
             [alt]="highlightedProfessional.name" 
             class="w-16 h-16 rounded-xl object-cover">
        <div class="ml-4">
          <p class="font-bold text-lg text-slate-900">{{ highlightedProfessional.name }}</p>
          <p class="text-sm text-slate-600">{{ highlightedProfessional.profession }}</p>
          <div class="flex items-center mt-1">
            <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
            </svg>
            <span class="text-slate-700 font-semibold ml-1">{{ highlightedProfessional.rating }}</span>
            <span class="text-slate-500 text-sm ml-2">({{ highlightedProfessional.reviews }})</span>
          </div>
        </div>
      </div>
      <button class="mt-3 w-full bg-indigo-600 text-white font-semibold py-2.5 rounded-xl hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105"
              (click)="onProfessionalBook(highlightedProfessional)">
        Ver perfil y Agendar
      </button>
    </div>

    <!-- Other Professionals List -->
    <div class="space-y-3">
      <div *ngFor="let professional of professionals; let i = index" 
           [class.hidden]="i === 0 && highlightedProfessional"
           class="p-3 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 cursor-pointer transition-colors"
           (click)="onProfessionalClick(professional)">
        <div class="flex items-center">
          <img [src]="professional.avatar" 
               [alt]="professional.name" 
               class="w-12 h-12 rounded-lg object-cover">
          <div class="ml-3 flex-1">
            <p class="font-semibold text-slate-900 text-sm">{{ professional.name }}</p>
            <p class="text-xs text-slate-600">{{ professional.profession }}</p>
            <div class="flex items-center mt-1">
              <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
              <span class="text-slate-700 font-medium ml-1 text-xs">{{ professional.rating }}</span>
              <span class="text-slate-500 text-xs ml-1">({{ professional.reviews }})</span>
            </div>
          </div>
          <button class="text-indigo-600 hover:text-indigo-800 text-xs font-medium px-2 py-1 rounded-lg hover:bg-indigo-50 transition-colors"
                  (click)="onProfessionalBook(professional); $event.stopPropagation()">
            Ver
          </button>
        </div>
      </div>
    </div>
  </aside>

  <!-- Right Panel: Map View -->
  <div class="w-2/3 bg-slate-200 flex items-center justify-center relative">
    <ui-map-view
      [title]="'Mapa de Servicios'"
      [subtitle]="'Encuentra servicios cerca de ti'"
      [markers]="mapMarkers"
      [center]="mapCenter"
      [zoom]="mapZoom"
      [height]="'100%'"
      [showControls]="showMapControls"
      [showLegend]="showMapLegend"
      [allowFullscreen]="true"
      (markerClick)="onMarkerClick($event)"
      (markerAction)="onMarkerAction($event)"
      (viewModeChange)="onViewModeChange($event)"
    ></ui-map-view>
  </div>
</section>
