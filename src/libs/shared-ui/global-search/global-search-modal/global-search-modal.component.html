<!-- Dropdown contextual que se extiende desde el input -->
<div 
  *ngIf="isOpen"
  class="absolute top-full left-0 right-0 mt-1 bg-white rounded-xl shadow-2xl border border-slate-200 z-50 overflow-hidden"
  [@fadeInOut]="isOpen ? 'in' : 'out'">
  
  <!-- Barra de búsqueda activa dentro del dropdown -->
  <div class="relative p-3 border-b border-slate-200">
    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
      <ui-icon name="search" class="h-5 w-5 text-slate-400"></ui-icon>
    </div>
    <input 
      #searchInput
      type="text" 
      [(ngModel)]="searchQuery"
      (input)="onSearchInput($event)"
      (keydown)="onKeyDown($event)"
      placeholder="Busca ayuda (ej. 'cambiar mi foto', 'horarios'...)" 
      class="block w-full border-0 bg-white py-3 pl-11 pr-4 text-slate-800 placeholder:text-slate-400 focus:ring-0 text-base">
  </div>

  <!-- Contenido del dropdown: Sugerencias -->
  <div class="max-h-[400px] overflow-y-auto">
    <!-- Búsquedas Recientes -->
    <div *ngIf="recentSearches.length > 0 && searchResults.length === 0 && !searchQuery" class="p-4 border-b border-slate-100">
      <h3 class="font-semibold text-slate-500 mb-3 flex justify-between items-center text-sm">
        Búsquedas Recientes
        <button (click)="clearRecentSearches()" class="text-xs text-red-500 hover:text-red-700">Limpiar</button>
      </h3>
      <div class="flex flex-wrap gap-2">
        <span *ngFor="let query of recentSearches" 
              (click)="onRecentSearchClick(query)"
              class="px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-sm cursor-pointer hover:bg-slate-200 transition-colors">
          {{ query }}
        </span>
      </div>
    </div>

    <!-- Resultados de búsqueda -->
    <div *ngIf="searchResults.length > 0" class="p-4">
      <h3 class="font-semibold text-slate-500 mb-3 text-sm">Resultados de búsqueda</h3>
      <ui-search-suggestion-item 
        *ngFor="let result of searchResults" 
        [suggestion]="result"
        (click)="onSuggestionClick(result)">
      </ui-search-suggestion-item>
    </div>
    
    <!-- Sugerencias por defecto -->
    <div *ngIf="searchResults.length === 0 && !searchQuery" class="p-4">
      <h3 class="font-semibold text-slate-500 mb-3 text-sm">Sugerencias para ti</h3>
      <ui-search-suggestion-item 
        *ngFor="let suggestion of defaultSuggestions" 
        [suggestion]="suggestion"
        (click)="onSuggestionClick(suggestion)">
      </ui-search-suggestion-item>
    </div>
    
    <!-- Estado de carga -->
    <div *ngIf="isLoading" class="flex items-center justify-center py-6">
      <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"></div>
      <span class="ml-2 text-slate-500 text-sm">Buscando...</span>
    </div>
    
    <!-- Sin resultados -->
    <div *ngIf="searchQuery && searchResults.length === 0 && !isLoading" class="text-center py-6">
      <ui-icon name="search" class="text-gray-400 mb-2" style="width: 32px; height: 32px;"></ui-icon>
      <p class="text-slate-500 font-medium text-sm">No se encontraron resultados para "{{ searchQuery }}"</p>
      <p class="text-xs text-slate-400 mt-1">Intenta con otros términos de búsqueda</p>
    </div>
  </div>
</div>