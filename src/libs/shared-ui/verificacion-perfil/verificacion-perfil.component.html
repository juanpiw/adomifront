
<div class="verificacion-perfil">
  <div *ngIf="statusLoading" class="verificacion-loading">
    <div class="spinner"></div>
    <p>Cargando estado de verificación…</p>
  </div>

  <div *ngIf="statusError" class="verificacion-error">
    {{ statusError }}
  </div>

  <div *ngIf="feedbackMessage && feedbackMessage.type === 'success'" class="verificacion-success">
    {{ feedbackMessage.text }}
  </div>
  <div *ngIf="feedbackMessage && feedbackMessage.type === 'error'" class="verificacion-error">
    {{ feedbackMessage.text }}
  </div>

  <!-- Estado: Sin verificación -->
  <div *ngIf="!statusLoading && !hasVerification" class="verificacion-content">
    
    <!-- Paso 1: Bienvenida -->
    <div *ngIf="currentStep === 1" class="verificacion-step">
      <div class="verificacion-header">
        <div class="verificacion-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 class="verificacion-title">Construyamos un perfil de confianza</h2>
        <p class="verificacion-description">
          Verificar tu identidad nos ayuda a mantener Adomiapp como una comunidad segura para clientes y profesionales. 
          Tu información está protegida.
        </p>
        <p class="verificacion-note">
          Necesitarás tu <strong>Cédula de Identidad</strong> vigente.
        </p>
      </div>
      
      <div class="verificacion-actions">
        <ui-button variant="primary" (click)="startVerification()">
          Empezar Verificación
        </ui-button>
      </div>
    </div>

    <!-- Paso 2: Subida de Documentos -->
    <div *ngIf="currentStep === 2" class="verificacion-step">
      <div class="verificacion-header">
        <h2 class="verificacion-title">Sube tu Cédula de Identidad</h2>
        <p class="verificacion-description">
          Asegúrate de que las fotos sean claras y todos los datos legibles.
        </p>
        <div class="verificacion-form">
          <label for="documentNumber">Número de documento</label>
          <input id="documentNumber" type="text" [(ngModel)]="documentNumber" maxlength="64" placeholder="Ej: 12.345.678-9" />
        </div>
        <p class="verificacion-hint">
          Formato sugerido: RUT con guion o número de documento según corresponda.
        </p>
      </div>

      <div class="verificacion-upload">
        <!-- Anverso -->
        <div class="verificacion-upload-section">
          <label class="verificacion-upload-label">1. Lado Frontal (Anverso)</label>
          <label for="front-file" class="verificacion-upload-area">
            <input 
              id="front-file" 
              type="file" 
              accept="image/*" 
              (change)="onFileSelected($event, 'front')"
              style="display: none;"
            >
            <ng-container *ngIf="previews.front; else frontIcon">
              <div class="verificacion-upload-icon">
                <img [src]="previews.front" alt="Anverso" />
              </div>
              <p class="verificacion-upload-text">Imagen cargada. Toca para reemplazarla.</p>
            </ng-container>
            <ng-template #frontIcon>
              <div class="verificacion-upload-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
              <p class="verificacion-upload-text">Tocar para subir foto</p>
            </ng-template>
          </label>
        </div>

        <!-- Reverso -->
        <div class="verificacion-upload-section">
          <label class="verificacion-upload-label">2. Lado Trasero (Reverso)</label>
          <label for="back-file" class="verificacion-upload-area">
            <input 
              id="back-file" 
              type="file" 
              accept="image/*" 
              (change)="onFileSelected($event, 'back')"
              style="display: none;"
            >
            <ng-container *ngIf="previews.back; else backIcon">
              <div class="verificacion-upload-icon">
                <img [src]="previews.back" alt="Reverso" />
              </div>
              <p class="verificacion-upload-text">Imagen cargada. Toca para reemplazarla.</p>
            </ng-container>
            <ng-template #backIcon>
              <div class="verificacion-upload-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
              <p class="verificacion-upload-text">Tocar para subir foto</p>
            </ng-template>
          </label>
        </div>

        <!-- Selfie opcional -->
        <div class="verificacion-upload-section">
          <label class="verificacion-upload-label">3. Selfie sosteniendo tu documento (opcional)</label>
          <label for="selfie-file" class="verificacion-upload-area optional">
            <input 
              id="selfie-file" 
              type="file" 
              accept="image/*" 
              (change)="onSelfieSelected($event)"
              style="display: none;"
            >
            <ng-container *ngIf="previews.selfie; else selfieIcon">
              <div class="verificacion-upload-icon">
                <img [src]="previews.selfie" alt="Selfie" />
              </div>
              <p class="verificacion-upload-text">Selfie cargada. Toca para reemplazarla.</p>
            </ng-container>
            <ng-template #selfieIcon>
              <div class="verificacion-upload-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-4.553a.5.5 0 00-.707-.707L14.293 9.293A1 1 0 0113.586 9H12a1 1 0 01-1-1V6.414a1 1 0 01.293-.707L15.75 1.25a.5.5 0 10-.707-.707L10.586 4.999A2 2 0 0010 6.414V8a2 2 0 002 2h1.586a2 2 0 001.414-.586z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 012-2h3m4 0h3a2 2 0 012 2v1H5v-1z" />
                </svg>
              </div>
              <p class="verificacion-upload-text">Opcional pero recomendado para acelerar la verificación.</p>
            </ng-template>
          </label>
        </div>
      </div>

      <!-- Mensaje de error -->
      <div *ngIf="uploadError && !feedbackMessage" class="verificacion-error">
        {{ uploadError }}
      </div>

      <div class="verificacion-actions">
        <ui-button 
          variant="primary" 
          (click)="uploadDocuments()"
          [disabled]="!canUpload">
          <span *ngIf="!isUploading">Enviar Documentos</span>
          <span *ngIf="isUploading">Subiendo...</span>
        </ui-button>
      </div>
    </div>

    <!-- Paso 3: En Revisión -->
    <div *ngIf="currentStep === 3" class="verificacion-step">
      <div class="verificacion-header">
        <div class="verificacion-icon verificacion-icon--warning">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 class="verificacion-title">Documentos en revisión</h2>
        <p class="verificacion-description" *ngIf="isPending">
          Recibimos tu información. Nuestro equipo la revisará y te notificaremos en las próximas 
          <strong>24-48 horas</strong>.
        </p>
        <p class="verificacion-description" *ngIf="isApproved">
          Todo listo: tu insignia de identidad verificada ya está visible para los clientes.
        </p>
        <p class="verificacion-note">
          Puedes cerrar esta ventana. Te avisaremos por email y notificación en la app ante cualquier actualización.
        </p>
      </div>

      <div class="verificacion-actions">
        <ui-button variant="secondary" (click)="onFinishProcess()">
          Entendido
        </ui-button>
      </div>
    </div>
  </div>

  <!-- Estado: Aprobado -->
  <div *ngIf="isApproved" class="verificacion-approved">
    <div class="verificacion-header">
      <div class="verificacion-icon verificacion-icon--success">
        <svg style="width: 100%; height: 100%;" viewBox="0 0 52 52">
          <circle style="color: #dcfce7;" cx="26" cy="26" r="25" fill="currentColor"/>
          <path class="checkmark-path" style="color: #16a34a;" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" d="M14 27l7 7 16-16"/>
        </svg>
      </div>
      <h2 class="verificacion-title">¡Perfil Verificado!</h2>
      <p class="verificacion-description">
        Felicidades, tu identidad ha sido confirmada.
      </p>
      <div class="verificacion-badge">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zM9 11a1 1 0 112 0v2a1 1 0 11-2 0v-2z" clip-rule="evenodd" />
          <path d="M10 5a1 1 0 100 2 1 1 0 000-2z" />
        </svg>
        Perfil Verificado
      </div>
    </div>
  </div>

  <!-- Estado: Rechazado -->
  <div *ngIf="isRejected" class="verificacion-rejected">
    <div class="verificacion-header">
      <div class="verificacion-icon verificacion-icon--error">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
        </svg>
      </div>
      <h2 class="verificacion-title">Verificación Rechazada</h2>
      <p class="verificacion-description">
        Tu verificación fue rechazada. Por favor, revisa los documentos y vuelve a intentar.
      </p>
      <p *ngIf="rejectionReason" class="verificacion-reason">
        Motivo del rechazo: <strong>{{ rejectionReason }}</strong>
      </p>
    </div>

    <div class="verificacion-actions">
      <ui-button variant="primary" (click)="goToStep(1)">
        Intentar de Nuevo
      </ui-button>
    </div>
  </div>
</div>











