<!-- Componente: Formulario de Configuración de Pagos -->
<div class="payment-settings">
  <h2>Datos de Transferencia Bancaria</h2>

  <div class="payment-form-container metric-card">
    <form class="payment-settings-form" (ngSubmit)="onSave()">
      <!-- Tipo de Cuenta -->
      <div class="form-group">
        <label for="account_type" class="form-label">Tipo de Cuenta</label>
        <select 
          id="account_type" 
          name="account_type" 
          [(ngModel)]="paymentSettings.accountType"
          (ngModelChange)="onSettingsChange()"
          required 
          class="form-select">
          <option value="corriente">Cuenta Corriente</option>
          <option value="vista">Cuenta Vista/RUT</option>
          <option value="ahorro">Cuenta de Ahorro</option>
        </select>
      </div>

      <!-- Banco -->
      <div class="form-group">
        <label for="bank_name" class="form-label">Banco</label>
        <input 
          type="text" 
          id="bank_name" 
          name="bank_name" 
          [(ngModel)]="paymentSettings.bankName"
          (ngModelChange)="onSettingsChange()"
          placeholder="Ej: Banco de Chile" 
          required 
          class="form-input">
      </div>

      <!-- Número de Cuenta -->
      <div class="form-group">
        <label for="account_number" class="form-label">Número de Cuenta</label>
        <input 
          type="text" 
          id="account_number" 
          name="account_number" 
          [(ngModel)]="paymentSettings.accountNumber"
          (ngModelChange)="onSettingsChange()"
          placeholder="00012345678" 
          required 
          class="form-input">
      </div>

      <!-- Nombre del Titular -->
      <div class="form-group">
        <label for="holder_name" class="form-label">Nombre del Titular</label>
        <input 
          type="text" 
          id="holder_name" 
          name="holder_name" 
          [(ngModel)]="paymentSettings.holderName"
          (ngModelChange)="onSettingsChange()"
          placeholder="Juan Pérez" 
          required 
          class="form-input">
      </div>

      <!-- RUT del Titular -->
      <div class="form-group">
        <label for="rut_holder" class="form-label">RUT del Titular</label>
        <input 
          type="text" 
          id="rut_holder" 
          name="rut_holder" 
          [(ngModel)]="paymentSettings.rutHolder"
          (ngModelChange)="onSettingsChange()"
          placeholder="12.345.678-9" 
          required 
          class="form-input">
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="save-payment-btn"
          [disabled]="isSaving">
          <span *ngIf="!isSaving">Guardar Configuración de Pago</span>
          <span *ngIf="isSaving">Guardando...</span>
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="errorMessage" style="color:#b91c1c; margin-top:8px;">{{ errorMessage }}</div>

  <!-- Aviso de Seguridad -->
  <div class="security-notice">
    <div class="notice-content">
      <ui-icon name="shield-check" [size]="20" class="notice-icon"></ui-icon>
      <p>
        <span class="font-bold">Seguridad:</span> Todos tus datos bancarios son cifrados y utilizados únicamente para realizar tus depósitos de ingresos. Nunca compartimos esta información.
      </p>
    </div>
  </div>

  <!-- Mensaje de Éxito -->
  <div *ngIf="showSuccessMessage" class="success-message">
    <ui-icon name="check-circle" [size]="20" class="success-icon"></ui-icon>
    <span>Configuración guardada exitosamente</span>
  </div>

  <!-- Stripe Connect / Billing (para pruebas de migración) -->
  <div class="metric-card" style="margin-top:16px;">
    <h3>Stripe Connect (Piloto)</h3>
    <div style="display:flex; gap:8px; flex-wrap: wrap;">
      <button class="save-payment-btn" type="button" (click)="onConnectStripe()" [disabled]="connecting">Conectar Stripe</button>
      <button class="save-payment-btn" type="button" (click)="onOpenDashboard()">Abrir Dashboard Stripe</button>
      <button class="save-payment-btn" type="button" (click)="onSetupFallbackCard()">Configurar Tarjeta de Respaldo</button>
      <button class="save-payment-btn" type="button" (click)="onLoadDebts()" [disabled]="loadingDebts">Ver Deudas Cash</button>
    </div>
    <div *ngIf="debts?.length" style="margin-top:8px;">
      <h4>Deudas</h4>
      <ul>
        <li *ngFor="let d of debts">#{{ d.id }} · {{ d.commission_amount }} {{ d.currency }} · {{ d.status }} · venc: {{ d.due_date | date:'shortDate' }}</li>
      </ul>
    </div>
  </div>

  <!-- Transbank Onboarding (Comercio Secundario) -->
  <div class="metric-card" style="margin-top:16px;">
    <h3>Transbank Webpay Mall</h3>
    <div style="display:flex; gap:8px; align-items:center; flex-wrap: wrap; margin-bottom:8px;">
      <button class="save-payment-btn" type="button" (click)="onTbkCreate()" [disabled]="tbkLoading">Crear Comercio Secundario</button>
      <button class="save-payment-btn" type="button" (click)="onTbkStatus()" [disabled]="tbkLoading">Actualizar Estado</button>
      <button class="save-payment-btn" type="button" (click)="onTbkDelete()" [disabled]="tbkLoading || !tbkCode">Dar de baja</button>
      <span *ngIf="tbkLoading">Cargando...</span>
      <span *ngIf="tbkStatus" class="chip" [ngStyle]="{
        'background': tbkStatus==='active' ? '#dcfce7' : (tbkStatus==='pending' ? '#fef9c3' : '#fee2e2'),
        'color': tbkStatus==='active' ? '#166534' : (tbkStatus==='pending' ? '#92400e' : '#991b1b'),
        'padding':'4px 8px', 'border-radius':'999px', 'font-size':'12px'
      }">Estado: {{ tbkStatus }}</span>
      <span *ngIf="tbkCode" style="font-size:12px; color:#334155;">Código: {{ tbkCode }}</span>
    </div>
    <div *ngIf="tbkError" style="color:#b91c1c;">{{ tbkError }}</div>
    <p style="margin:0; color:#475569; font-size:13px;">Crea y administra tu comercio secundario directamente desde Adomi para poder recibir pagos con Webpay Mall.</p>
  </div>
</div>








