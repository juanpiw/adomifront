<button
  type="button"
  class="geo-btn"
  [class.geo-btn--loading]="loading"
  (click)="onClick($event)">
  <span *ngIf="!loading">{{ label }}</span>
  <span *ngIf="loading">Registrando‚Ä¶</span>
</button>

<div class="geo-meta" *ngIf="badgeText || error">
  <span *ngIf="badgeText" class="geo-badge" [class.geo-badge--good]="lastResult?.is_match" [class.geo-badge--bad]="lastResult?.is_match === false">
    {{ badgeText }}
    <ng-container *ngIf="lastResult?.distance_m !== undefined && lastResult?.radius_m !== undefined">
      ‚Ä¢ {{ lastResult?.distance_m }}m / {{ lastResult?.radius_m }}m
    </ng-container>
  </span>
  <span *ngIf="error" class="geo-error">{{ error }}</span>
</div>

<!-- Modal de verificaci√≥n de ubicaci√≥n -->
<div class="geo-modal" *ngIf="modalOpen" (click)="closeModal($event)">
  <div class="geo-modal__dialog" (click)="$event.stopPropagation()">
    <div class="geo-modal__header">
      <h4 class="geo-modal__title">Verificaci√≥n de ubicaci√≥n</h4>
      <button type="button" class="geo-modal__close" (click)="closeModal($event)">√ó</button>
    </div>

    <div class="geo-modal__body">
      <div class="geo-modal__section" *ngIf="destinationLabel">
        <div class="geo-modal__label">Ubicaci√≥n del servicio</div>
        <div class="geo-modal__value">üìç {{ destinationLabel }}</div>
      </div>

      <div class="geo-modal__message" [class.geo-modal__message--good]="modalState === 'match'" [class.geo-modal__message--bad]="modalState === 'no_match' || modalState === 'permission_denied' || modalState === 'no_dest_coords'">
        {{ modalMessage || 'Verificando‚Ä¶' }}
      </div>

      <div class="geo-modal__metrics" *ngIf="lastResult?.distance_m !== undefined && lastResult?.radius_m !== undefined">
        <span>Distancia: <strong>{{ lastResult?.distance_m }}m</strong></span>
        <span>Radio permitido: <strong>{{ lastResult?.radius_m }}m</strong></span>
      </div>

      <ul class="geo-modal__tips" *ngIf="modalState === 'no_match' || modalState === 'permission_denied' || modalState === 'timeout' || modalState === 'position_unavailable'">
        <li>Activa <strong>Ubicaci√≥n/GPS</strong> en tu tel√©fono.</li>
        <li>En Android/iPhone: habilita <strong>alta precisi√≥n</strong>.</li>
        <li>Si lo negaste, habilita permisos de ubicaci√≥n para el navegador.</li>
      </ul>
    </div>

    <div class="geo-modal__actions">
      <button type="button" class="geo-modal__btn" (click)="closeModal($event)">Cerrar</button>
      <button type="button" class="geo-modal__btn geo-modal__btn--primary" [disabled]="loading" (click)="retry($event)">
        {{ loading ? 'Reintentando‚Ä¶' : 'Reintentar / Recargar ubicaci√≥n' }}
      </button>
    </div>
  </div>
</div>


