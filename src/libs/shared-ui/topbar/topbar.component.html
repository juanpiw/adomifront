<div class="topbar elevated" [class.topbar--hidden-mobile-conversaciones]="isConversacionesRoute">
  <div class="topbar__info">
    <input 
      *ngIf="config.showSearch"
      class="search" 
      [placeholder]="config.searchPlaceholder"
      readonly
      (click)="onHelpClick()" />

    <span 
      *ngIf="config.planBadge as planBadge"
      class="plan-badge"
      [ngClass]="{'plan-badge--founder': planBadge.variant === 'founder'}">
      {{ planBadge.label }}
    </span>

    <ng-container *ngIf="config.verificationBadge as vb">
      <button
        *ngIf="vb.link; else verificationLabel"
        type="button"
        class="verification-badge verification-badge--clickable"
        [ngClass]="{
          'verification-badge--verified': vb.variant === 'verified',
          'verification-badge--pending': vb.variant === 'pending',
          'verification-badge--rejected': vb.variant === 'rejected'
        }"
        [title]="vb.tooltip || vb.label"
        (click)="navigateTo(vb.link)">
        <ui-icon name="shield-check"></ui-icon>
        {{ vb.label }}
      </button>
      <ng-template #verificationLabel>
        <span
          class="verification-badge"
          [ngClass]="{
            'verification-badge--verified': vb.variant === 'verified',
            'verification-badge--pending': vb.variant === 'pending',
            'verification-badge--rejected': vb.variant === 'rejected'
          }"
          [title]="vb.tooltip || vb.label">
          <ui-icon name="shield-check"></ui-icon>
          {{ vb.label }}
        </span>
      </ng-template>
    </ng-container>
  </div>
  
  <div class="actions">
    <button 
      *ngIf="config.showHamburger"
      class="hamburger" 
      (click)="onHamburgerClick()">
      <ui-icon name="menu"></ui-icon>
    </button>
    
    <ui-notification-container
      *ngIf="config.showNotifications"
      [userProfile]="config.userProfile || 'client'"
      (notificationClick)="onNotificationClick($event)">
    </ui-notification-container>
    
    <button 
      *ngIf="config.showSettings"
      class="icon" 
      (click)="onSettingsClick()">
      <ui-icon name="settings"></ui-icon>
    </button>
  </div>
</div>

<div *ngIf="cashNotice"
     class="topbar-banner"
     [ngClass]="{
       'topbar-banner--overdue': cashNotice.status === 'overdue',
       'topbar-banner--review': cashNotice.status === 'under_review',
       'topbar-banner--rejected': cashNotice.status === 'rejected'
     }">
  <div class="topbar-banner__icon">
    <ui-icon name="alert-triangle"></ui-icon>
  </div>
  <div class="topbar-banner__content">
    <span class="topbar-banner__title">
      <ng-container [ngSwitch]="cashNotice.status">
        <ng-container *ngSwitchCase="'overdue'">Tienes comisiones en efectivo vencidas</ng-container>
        <ng-container *ngSwitchCase="'under_review'">Comprobante en revisión</ng-container>
        <ng-container *ngSwitchCase="'rejected'">Comprobante rechazado</ng-container>
        <ng-container *ngSwitchDefault>Debes depositar saldo a la app</ng-container>
      </ng-container>
    </span>
    <span class="topbar-banner__subtitle">
      <ng-container [ngSwitch]="cashNotice.status">
        <ng-container *ngSwitchCase="'overdue'">
          Total pendiente: ${{ cashNotice.amount | number:'1.0-0' }}
          <span *ngIf="cashNotice.overdueAmount"> • Vencido: ${{ cashNotice.overdueAmount | number:'1.0-0' }}</span>
          <span *ngIf="cashNotice.dueDateLabel">
            • Regulariza antes de {{ cashNotice.dueDateLabel }}
          </span>
        </ng-container>
        <ng-container *ngSwitchCase="'under_review'">
          Total en revisión: ${{ cashNotice.amount | number:'1.0-0' }}
          <span *ngIf="cashNotice.dueDateLabel">
            • Próxima fecha límite {{ cashNotice.dueDateLabel }}
          </span>
          <span *ngIf="cashNotice.manualUpdatedAt">
            • Actualizado {{ cashNotice.manualUpdatedAt | date:'dd/MM HH:mm' }}
          </span>
        </ng-container>
        <ng-container *ngSwitchCase="'rejected'">
          Debes reenviar tu comprobante por ${{ cashNotice.amount | number:'1.0-0' }}.
          <span *ngIf="cashNotice.dueDateLabel">
            • Próxima fecha límite {{ cashNotice.dueDateLabel }}
          </span>
        </ng-container>
        <ng-container *ngSwitchDefault>
          Total pendiente: ${{ cashNotice.amount | number:'1.0-0' }}
          <span *ngIf="cashNotice.dueDateLabel">
            • Próxima fecha límite {{ cashNotice.dueDateLabel }}
          </span>
        </ng-container>
      </ng-container>
    </span>
  </div>
  <button type="button" class="topbar-banner__action" (click)="onCashNoticeClick()">
    <ng-container [ngSwitch]="cashNotice.status">
      <ng-container *ngSwitchCase="'under_review'">Ver estado</ng-container>
      <ng-container *ngSwitchCase="'rejected'">Reenviar comprobante</ng-container>
      <ng-container *ngSwitchDefault>Ir a Pagos en Efectivo</ng-container>
    </ng-container>
  </button>
</div>

<!-- Modal de Búsqueda Global -->
<ui-global-search-modal
  [isOpen]="isSearchModalOpen"
  (close)="onSearchModalClose()"
  (suggestionClick)="onSearchSuggestionClick($event)">
</ui-global-search-modal>
