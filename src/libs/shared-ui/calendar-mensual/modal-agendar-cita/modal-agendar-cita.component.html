<!-- Modal para Crear Nueva Cita -->
<div 
  *ngIf="isOpen"
  class="modal-backdrop"
  (click)="onBackdropClick($event)"
  [@fadeInOut]="isOpen ? 'in' : 'out'">
  
  <div 
    class="modal-content"
    [@scaleInOut]="isOpen ? 'in' : 'out'"
    (click)="$event.stopPropagation()">
    
    <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path *ngIf="mode === 'bloqueo'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
            <path *ngIf="mode === 'cita'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            <path *ngIf="mode === 'cita'" stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3"></path>
          </svg>
          {{ mode === 'bloqueo' ? '游 Bloquear Espacio' : 'Crear Nueva Cita' }}
        </h2>
      </div>

      <div class="modal-body">
        <!-- T칤tulo / Motivo -->
        <div class="form-group">
          <label for="eventTitle" class="form-label">
            {{ mode === 'bloqueo' ? 'Motivo del Bloqueo' : 'T칤tulo' }}
          </label>
          <input 
            type="text" 
            id="eventTitle"
            formControlName="title"
            [placeholder]="mode === 'bloqueo' ? 'Ej: Reuni칩n personal, Vacaciones...' : 'Ej: Corte de Pelo, Reuni칩n personal...'"
            class="form-input"
            [class.form-input--error]="title?.invalid && title?.touched">
          <p 
            *ngIf="title?.invalid && title?.touched && mode === 'cita'" 
            class="form-error">
            El t칤tulo es obligatorio (m칤nimo 3 caracteres).
          </p>
        </div>

        <!-- Servicio (solo modo cita) -->
        <div class="form-group" *ngIf="mode === 'cita'">
          <label for="eventService" class="form-label">Servicio</label>
          <ng-container *ngIf="services?.length; else noServicesAvailable">
            <select
              id="eventService"
              formControlName="serviceId"
              class="form-input"
              [class.form-input--error]="serviceId?.invalid && serviceId?.touched">
              <option *ngFor="let svc of services" [ngValue]="svc.id">
                {{ svc.name }}
              </option>
            </select>
            <p
              *ngIf="serviceId?.invalid && serviceId?.touched"
              class="form-error">
              Debes seleccionar el servicio que vas a realizar.
            </p>
          </ng-container>
          <ng-template #noServicesAvailable>
            <p class="form-helper">
              No tienes servicios configurados. Ve a tu perfil para crear uno y poder agendar.
            </p>
          </ng-template>
        </div>

        <!-- Cliente (solo en modo cita) -->
        <div class="form-group" *ngIf="mode === 'cita'">
          <label for="eventClient" class="form-label">Cliente (Opcional)</label>
          <input 
            type="text" 
            id="eventClient"
            formControlName="client"
            placeholder="Buscar o a침adir un cliente..."
            class="form-input">
        </div>
        
        <!-- Checkbox: Bloquear todo el d칤a (solo en modo bloqueo) -->
        <div class="form-group" *ngIf="mode === 'bloqueo'">
          <label class="form-checkbox">
            <input 
              type="checkbox" 
              [checked]="blockWholeDay"
              (change)="toggleBlockWholeDay()">
            <span>Bloquear todo el d칤a</span>
          </label>
        </div>

        <!-- Fecha y Horas -->
        <div class="form-row">
          <div class="form-col">
            <label for="eventDate" class="form-label">Fecha</label>
            <input 
              type="date" 
              id="eventDate"
              formControlName="date"
              class="form-input"
              [class.form-input--error]="date?.invalid && date?.touched">
          </div>
          <div class="form-col" *ngIf="!blockWholeDay">
            <label for="eventStartTime" class="form-label">Desde</label>
            <input 
              type="time" 
              id="eventStartTime"
              formControlName="startTime"
              class="form-input"
              [class.form-input--error]="startTime?.invalid && startTime?.touched">
          </div>
          <div class="form-col" *ngIf="!blockWholeDay">
            <label for="eventEndTime" class="form-label">Hasta</label>
            <input 
              type="time" 
              id="eventEndTime"
              formControlName="endTime"
              class="form-input"
              [class.form-input--error]="endTime?.invalid && endTime?.touched">
          </div>
        </div>

        <!-- Notas -->
        <div class="form-group">
          <label for="eventNotes" class="form-label">Notas {{ mode === 'bloqueo' ? '(Opcional)' : '' }}</label>
          <textarea 
            id="eventNotes"
            formControlName="notes"
            rows="3"
            [placeholder]="mode === 'bloqueo' ? 'Informaci칩n adicional...' : 'A침adir detalles importantes...'"
            class="form-textarea"></textarea>
        </div>

        <!-- Selector de Color (solo en modo cita) -->
        <div class="form-group" *ngIf="mode === 'cita'">
          <label class="form-label">Etiqueta de Color</label>
          <div class="color-picker">
            <button 
              *ngFor="let colorOption of availableColors"
              type="button"
              [style.background-color]="colorOption.color"
              [class.color-picker__btn--selected]="isColorSelected(colorOption.color)"
              [attr.aria-label]="colorOption.label"
              [title]="colorOption.label"
              class="color-picker__btn"
              (click)="selectColor(colorOption.color)">
            </button>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          type="button"
          class="btn btn--secondary"
          (click)="closeModal()">
          Cancelar
        </button>
        <button 
          type="submit"
          [class.btn--danger]="mode === 'bloqueo'"
          class="btn btn--primary">
          {{ mode === 'bloqueo' ? '游 Bloquear Espacio' : 'Guardar Cita' }}
        </button>
      </div>
    </form>
  </div>
</div>








