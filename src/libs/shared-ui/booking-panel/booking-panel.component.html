<aside class="booking-panel">
  <div class="booking-panel__card">
    <h3 class="booking-panel__title">Agendar una cita</h3>
    <div class="booking-panel__scroll">
      <div class="booking-panel__content">
        <div class="booking-panel__step">
          <p class="booking-panel__step-title">1. Elige un servicio</p>
          <div class="booking-panel__services">
            <button *ngFor="let service of data.services" 
                    class="booking-panel__service"
                    [class.booking-panel__service--active]="service.isActive"
                    (click)="onServiceClick(service.id)">
              <p class="booking-panel__service-name">{{ service.name }}</p>
              <p class="booking-panel__service-meta">{{ service.duration }} Â· {{ service.price }}</p>
            </button>
            <div class="booking-panel__error" *ngIf="errorService">{{ errorService }}</div>
          </div>
        </div>
        
        <div class="booking-panel__step">
          <p class="booking-panel__step-title">2. Elige una fecha</p>
          <div class="booking-panel__datepicker">
            <input type="date" 
                   class="booking-panel__date-input"
                   [min]="today"
                   [value]="data.selectedDate || data.summary.date"
                   (change)="onDateChange($event.target.value || '')">
            <div class="booking-panel__error" *ngIf="errorDate">{{ errorDate }}</div>
          </div>
        </div>
        
        <div class="booking-panel__step">
          <p class="booking-panel__step-title">3. Elige una hora</p>
          <div *ngIf="loadingSlots" class="booking-panel__loader">
            <div class="booking-panel__spinner"></div>
            <p>Cargando horarios disponiblesâ€¦</p>
          </div>
          <div class="booking-panel__times" *ngIf="!loadingSlots">
            <button *ngFor="let slot of displayedTimeSlots" 
                    class="booking-panel__time"
                    [class.booking-panel__time--selected]="slot.isSelected"
                    [class.booking-panel__time--blocked]="slot.reason === 'blocked'"
                    [class.booking-panel__time--unavailable]="!slot.isAvailable"
                    [disabled]="!slot.isAvailable"
                    [title]="getSlotTooltip(slot)"
                    (click)="onTimeClick(slot.time)">
              {{ slot.time }}
              <span *ngIf="slot.reason === 'blocked'" class="booking-panel__time-icon">ðŸ”’</span>
            </button>
            <div *ngIf="data.allowManualTime && (!data.timeSlots || data.timeSlots.length === 0)" class="booking-panel__time-manual">
              <input type="time" class="booking-panel__time-input"
                     (change)="onTimeChange($any($event.target).value || '')">
            </div>
            <p *ngIf="data.timeSlotsMessage" class="booking-panel__time-empty">
              {{ data.timeSlotsMessage }}
            </p>
            <div class="booking-panel__error" *ngIf="errorTime">{{ errorTime }}</div>
            <div class="booking-panel__future" *ngIf="futureSlots?.length">
              <p class="booking-panel__future-title">PrÃ³ximos horarios sugeridos</p>
              <div class="booking-panel__chips">
                <button class="booking-panel__chip"
                        type="button"
                        *ngFor="let suggestion of futureSlots"
                        (click)="onFutureSlotSuggestionClick(suggestion)">
                  {{ suggestion.dateLabel }}
                  <ng-container *ngIf="suggestion.time">
                    &nbsp;Â·&nbsp;{{ suggestion.time }}
                  </ng-container>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="booking-panel__summary">
          <div class="booking-panel__summary-card">
            <div class="booking-panel__row">
              <p class="booking-panel__label">Servicio:</p>
              <p class="booking-panel__value">{{ data.summary.service }}</p>
            </div>
            <div class="booking-panel__row">
              <p class="booking-panel__label">Fecha:</p>
              <p class="booking-panel__value">{{ data.summary.date }} a las {{ data.summary.time }}</p>
            </div>
            <div class="booking-panel__row">
              <p class="booking-panel__label">Precio:</p>
              <p class="booking-panel__value">{{ data.summary.price }}</p>
            </div>
          </div>
          <div class="booking-panel__success" *ngIf="successMessage">
            {{ successMessage }}
          </div>
          <button class="booking-panel__confirm" (click)="onConfirmBooking()">
            Agendar Cita
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmaciÃ³n -->
  <div class="booking-confirm__backdrop" *ngIf="isConfirmOpen" (click)="closeConfirm()"></div>
  <div class="booking-confirm__modal" *ngIf="isConfirmOpen">
    <div class="booking-confirm__header">
      <h4>Confirmar cita</h4>
      <button class="booking-confirm__close" (click)="closeConfirm()">âœ•</button>
    </div>
    <div class="booking-confirm__body">
      <p><strong>Servicio:</strong> {{ data.summary.service }}</p>
      <p><strong>Fecha y hora:</strong> {{ data.summary.date }} {{ data.summary.time }}</p>
      <p><strong>Precio:</strong> {{ data.summary.price }}</p>
      <div class="payment-method-pill">
        <span>MÃ©todo de pago:</span>
        <strong>{{ paymentMethodText() }}</strong>
      </div>
      <p class="booking-confirm__error" *ngIf="confirmError">{{ confirmError }}</p>
      <div class="booking-confirm__suggestions" *ngIf="alternativeSlots?.length">
        <p class="booking-confirm__suggestions-title">Horarios que siguen disponibles:</p>
        <div class="booking-confirm__chips">
          <button
            class="booking-confirm__chip"
            type="button"
            *ngFor="let option of alternativeSlots"
            (click)="onAlternativeSlotClick(option)">
            {{ option }}
          </button>
        </div>
      </div>
    </div>
    <div class="booking-confirm__actions">
      <button class="booking-confirm__btn booking-confirm__btn--secondary" [disabled]="confirming" (click)="closeConfirm()">Cancelar</button>
      <button class="booking-confirm__btn booking-confirm__btn--primary" [disabled]="confirming" (click)="confirmBookingNow()">
        <span *ngIf="!confirming">Confirmar</span>
        <span *ngIf="confirming">Confirmandoâ€¦</span>
      </button>
    </div>
  </div>
</aside>
