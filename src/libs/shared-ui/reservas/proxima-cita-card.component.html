<div class="pc-card" [class.pc-card--success]="data.successHighlight">
  <p class="pc-kicker" [class.pc-kicker--paid]="data.successHighlight || data.verification_code">
    {{ (data.successHighlight || data.verification_code) ? 'CITA PAGADA' : 'TU PRÓXIMA CITA (CONFIRMADA)' }}
  </p>
  <div class="pc-row">
    <div class="pc-col">
      <p class="pc-title">{{ data.titulo }}</p>
      <div class="pc-meta">
        <span class="pc-meta-item">
          <svg class="pc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          {{ data.fecha }}
        </span>
        <span class="pc-meta-item">
          <svg class="pc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          {{ data.hora }}
        </span>
      </div>
    </div>
    <div class="pc-count">
      <p class="pc-days">{{ data.diasRestantes }}</p>
      <p class="pc-days-label">días restantes</p>
    </div>
  </div>
  <div class="pc-actions">
    <button class="pc-btn primary" (click)="onContactarClick()">Contactar</button>
    <button class="pc-btn secondary" (click)="onReprogramarClick()">Reprogramar</button>
    <button class="pc-btn danger" (click)="onCancelarClick()">Cancelar Cita</button>
    <button *ngIf="data.mostrarPagar" class="pc-btn primary" (click)="onPagarClick()">Pagar</button>
    <button *ngIf="!data.mostrarPagar && data.verification_code && !data.refundRequested" class="pc-btn" (click)="onRefundClick()">Pedir devolución</button>
    <span *ngIf="data.refundRequested" style="color:#0e7490; font-weight:600; margin-left:8px;">Solicitud en proceso</span>
  </div>

  <!-- Código de verificación cuando está pagada -->
  <div *ngIf="!data.mostrarPagar && data.verification_code" style="margin-top:12px;">
    <ui-verificacion-code-card [code]="data.verification_code"></ui-verificacion-code-card>
  </div>

  <!-- Área de devolución -->
  <div *ngIf="showRefundArea" style="margin-top:12px;">
    <div style="background:#fff7ed;border:1px solid #fed7aa;border-radius:8px;padding:12px;">
      <div style="font-weight:600;margin-bottom:8px;">Solicitar devolución</div>
      <textarea [(ngModel)]="refundReason" rows="3" placeholder="Describe el motivo de la devolución (mínimo 10 caracteres)" style="width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:6px;"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button class="pc-btn primary" (click)="submitRefund()">Enviar solicitud</button>
        <button class="pc-btn" (click)="showRefundArea=false">Cancelar</button>
      </div>
    </div>
  </div>
</div>







