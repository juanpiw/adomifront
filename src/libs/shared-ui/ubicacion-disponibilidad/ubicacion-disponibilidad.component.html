<section class="ubicacion-disponibilidad">
  <h3 class="ubicacion-disponibilidad__title">Ubicación y Disponibilidad</h3>
  <p class="ubicacion-disponibilidad__subtitle">Define dónde trabajas y si estás aceptando nuevas reservas.</p>
  
  <div class="ubicacion-disponibilidad__content">
    <!-- Disponible para nuevas reservas -->
    <div class="ubicacion-disponibilidad__toggle-item">
      <label class="ubicacion-disponibilidad__toggle-label">Disponible para nuevas reservas</label>
      <div class="ubicacion-disponibilidad__toggle" (click)="onToggleNewBookings()">
        <div class="ubicacion-disponibilidad__toggle-track" 
             [class.ubicacion-disponibilidad__toggle-track--active]="settings.availableForNewBookings">
          <div class="ubicacion-disponibilidad__toggle-thumb"></div>
        </div>
      </div>
    </div>

    <!-- Compartir ubicación en tiempo real -->
    <div class="ubicacion-disponibilidad__toggle-item">
      <div class="ubicacion-disponibilidad__toggle-info">
        <label class="ubicacion-disponibilidad__toggle-label">Compartir mi ubicación en tiempo real</label>
        <p class="ubicacion-disponibilidad__toggle-description">
          Al activar, aparecerás en el mapa para clientes cercanos que buscan un servicio inmediato.
        </p>
      </div>
      <div class="ubicacion-disponibilidad__toggle" (click)="onToggleRealTimeLocation()">
        <div class="ubicacion-disponibilidad__toggle-track" 
             [class.ubicacion-disponibilidad__toggle-track--active]="settings.shareRealTimeLocation">
          <div class="ubicacion-disponibilidad__toggle-thumb"></div>
        </div>
      </div>
    </div>

    <!-- Botón actualizar ubicación actual -->
    <div class="ubicacion-disponibilidad__toggle-item" *ngIf="settings.shareRealTimeLocation">
      <button type="button" class="ubicacion-disponibilidad__add-button" (click)="updateCurrentLocation()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 2v4m0 12v4m10-10h-4M6 12H2m14.95-5.05l-2.83 2.83M8.88 15.12l-2.83 2.83M15.12 15.12l2.83 2.83M8.88 8.88L6.05 6.05"/>
        </svg>
        Actualizar ubicación actual
      </button>
    </div>

    <!-- Zonas de cobertura -->
    <div class="ubicacion-disponibilidad__zones">
      <label class="ubicacion-disponibilidad__zones-label">Zonas de Cobertura (a domicilio)</label>
      <p class="ubicacion-disponibilidad__zones-description">Añade las comunas en las que ofreces tus servicios.</p>
      
      <!-- Botón para abrir selector -->
      <button 
        type="button"
        class="ubicacion-disponibilidad__add-button"
        (click)="toggleLocationSelector()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
        Agregar comuna
      </button>

      <!-- Selector de región y comuna (popover) -->
      <div *ngIf="showLocationSelector" class="ubicacion-disponibilidad__selector">
        <div class="ubicacion-disponibilidad__selector-content">
          <!-- Selectores de región y comuna -->
          <div class="ubicacion-disponibilidad__selector-grid">
            <div>
              <label class="ubicacion-disponibilidad__selector-label">REGIÓN</label>
              <select 
                [(ngModel)]="selectedRegion"
                (change)="onRegionChange()"
                class="ubicacion-disponibilidad__select">
                <option value="">Selecciona una región</option>
                <option *ngFor="let region of regions" [value]="region.name">
                  {{ region.name }}
                </option>
              </select>
            </div>
            
            <div>
              <label class="ubicacion-disponibilidad__selector-label">COMUNA</label>
              <select 
                [(ngModel)]="selectedComuna"
                [disabled]="!selectedRegion"
                class="ubicacion-disponibilidad__select">
                <option value="">Selecciona una comuna</option>
                <option *ngFor="let comuna of comunasOfSelectedRegion" [value]="comuna">
                  {{ comuna }}
                </option>
              </select>
            </div>
          </div>

          <p class="ubicacion-disponibilidad__selector-divider">o</p>

          <!-- Búsqueda rápida -->
          <div class="ubicacion-disponibilidad__search-container">
            <input 
              type="text"
              [(ngModel)]="searchText"
              (input)="onSearchTextChange()"
              placeholder="Busca tu comuna directamente..."
              class="ubicacion-disponibilidad__search-input">
            
            <!-- Resultados de búsqueda -->
            <div *ngIf="searchResults.length > 0" class="ubicacion-disponibilidad__search-results">
              <button 
                *ngFor="let result of searchResults"
                type="button"
                class="ubicacion-disponibilidad__search-result"
                (click)="selectSearchResult(result)">
                <span class="ubicacion-disponibilidad__search-result-comuna">{{ result.comuna }}</span>
                <span class="ubicacion-disponibilidad__search-result-region">{{ result.region }}</span>
              </button>
            </div>
          </div>

          <!-- Botones de acción -->
          <div class="ubicacion-disponibilidad__selector-actions">
            <button 
              type="button"
              class="ubicacion-disponibilidad__selector-btn ubicacion-disponibilidad__selector-btn--cancel"
              (click)="toggleLocationSelector()">
              Cancelar
            </button>
            <button 
              type="button"
              class="ubicacion-disponibilidad__selector-btn ubicacion-disponibilidad__selector-btn--add"
              [disabled]="!selectedComuna"
              (click)="onAddZoneFromSelector()">
              Agregar
            </button>
          </div>
        </div>
      </div>
      
      <!-- Tags de zonas agregadas -->
      <div class="ubicacion-disponibilidad__zones-tags">
        <span 
          *ngFor="let zone of settings.coverageZones"
          class="ubicacion-disponibilidad__zone-tag">
          {{ zone.name }}
          <button 
            class="ubicacion-disponibilidad__zone-remove"
            (click)="onRemoveZone(zone.id)">
            ×
          </button>
        </span>
      </div>
    </div>
  </div>
</section>



